define(function(require){function e(n,r,i){n=n||"/",r=r||"",i=i||"~",this.toString=function(){return r?n+i+r:n},this.getPath=function(){return n},this.getSearch=function(){return r};var o=null;this.getQuery=function(n){if(!o)o=e.parseQuery(r);return n?o[n]:t.mix({},o)}}var t=require("./util");return e.prototype.compare=function(t){if("string"==typeof t)t=e.parse(t);var n={},r=this.getPath(),i=t.getPath();if(r===i)n.path=!1;else n.path={key:"path",self:r,other:i};var o=this.getQuery(),s=t.getQuery(),a={},u=[],f=!1;for(var c in o)if(o.hasOwnProperty(c)){var l=o[c],p=s[c];if(l!==p){f=!0;var h={key:c,self:l,other:p};u.push(h),a[c]=h}}for(var c in s)if(s.hasOwnProperty(c)&&!o.hasOwnProperty(c)){f=!0;var h={key:c,self:void 0,other:s[c]};u.push(h),a[c]=h}return n.queryDifference=u,n.query=f?a:!1,n},e.parse=function(n,r){var i={querySeparator:"~"};r=t.mix(i,r);var o=n.indexOf(r.querySeparator);if(o>=0)return new e(n.slice(0,o),n.slice(o+1),r.querySeparator);else return new e(n,"",r.querySeparator)},e.withQuery=function(n,r,i){n+="";var o={querySeparator:"~"};i=t.mix(o,i);var s=n.indexOf(i.querySeparator)<0?i.querySeparator:"&",a=e.serialize(r),u=n+s+a;return e.parse(u,i)},e.parseQuery=function(e){for(var t=e.split("&"),n={},r=0;r<t.length;r++){var i=t[r];if(i){var o=i.indexOf("="),s=0>o?decodeURIComponent(i):decodeURIComponent(i.slice(0,o)),a=0>o?!0:decodeURIComponent(i.slice(o+1));if(n.hasOwnProperty(s)){if(a!==!0)n[s]=[].concat(n[s],a)}else n[s]=a}else;}return n},e.serialize=function(e){if(!e)return"";var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(r)}return t.slice(1)},e.empty=new e,e});