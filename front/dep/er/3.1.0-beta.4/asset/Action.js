define(function(require){function e(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(!n.success)e.push(n)}return this.handleError(e)}function t(){this.disposed=!1,this.initialize()}var n=require("./util"),r=require("mini-event/EventTarget");return t.prototype.initialize=n.noop,t.prototype.context=null,t.prototype.modelType=null,t.prototype.viewType=null,t.prototype.enter=function(t){this.context=t||{},this.fire("enter");var r=n.mix({},t&&t.args);if(this.model)this.model.fill(r);else this.model=this.createModel(r);if(this.fire("beforemodelload"),this.model&&"function"==typeof this.model.load){var i=this.model.load();return i.then(n.bind(this.forwardToView,this),n.bind(e,this))}else return this.forwardToView(),require("./Deferred").resolved(this)},t.prototype.handleError=function(e){throw e},t.prototype.createModel=function(e){if(this.modelType){var t=new this.modelType(e);return t}else return{}},t.prototype.forwardToView=function(){if(this.disposed)return this;if(this.fire("modelloaded"),!this.view)this.view=this.createView();if(this.view){if(this.view.model=this.model,!this.view.container)this.view.container=this.context.container;this.fire("beforerender"),this.view.render(),this.fire("rendered"),this.initBehavior(),this.fire("entercomplete")}else{var e=require("./events");e.notifyError("No view attached to this action")}return this},t.prototype.createView=function(){return this.viewType?new this.viewType:null},t.prototype.initBehavior=n.noop,t.prototype.filterRedirect=n.noop,t.prototype.leave=function(){if(this.disposed)return this;if(this.disposed=!0,this.fire("beforeleave"),this.model){if("function"==typeof this.model.dispose)this.model.dispose();this.model=null}if(this.view){if("function"==typeof this.view.dispose)this.view.dispose();this.view=null}this.fire("leave"),this.destroyEvents()},t.prototype.redirect=function(e,t){var n=require("./locator");n.redirect(e,t)},t.prototype.reload=function(){var e=require("./locator");e.reload()},t.prototype.back=function(e){var t=this.context&&this.context.referrer,n=t||e;if(n)this.redirect(n)},n.inherits(t,r),t});