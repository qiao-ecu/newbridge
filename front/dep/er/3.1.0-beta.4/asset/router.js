define(function(require){function e(){this.routes=[],this.backup=null}function t(e){for(var t=require("./URL").parse(e.url),n=t.getPath(),r=0;r<this.routes.length;r++){var i=this.routes[r];if(i.rule instanceof RegExp&&i.rule.test(n)||i.rule===n)return void i.handler.call(this,t)}if(this.backup)this.backup(t);this.getEventBus().fire("route",{url:t,router:this})}var n=require("./util");n.inherits(e,require("mini-event/EventTarget")),e.prototype.add=function(e,t){this.routes.push({rule:e,handler:t})},e.prototype.setBackup=function(e){this.backup=e},e.prototype.getLocator=function(){return this.locator},e.prototype.setLocator=function(e){this.locator=e},e.prototype.getEventBus=function(){return this.eventBus},e.prototype.setEventBus=function(e){this.eventBus=e},e.prototype.start=function(){this.getLocator().on("redirect",t,this)};var r=new e;return r.setLocator(require("./locator")),r.setEventBus(require("./events")),r.Router=e,r});