define(function(require){function e(){var e=location.href.indexOf("#"),t=-1===e?"":location.href.slice(e);return t}function t(){var t=e();o.redirect(t)}function n(e){if(window.addEventListener)window.addEventListener("hashchange",t,!1);else if("onhashchange"in window&&document.documentMode>7)window.attachEvent("onhashchange",t);else a=setInterval(t,100);if(e)u=setTimeout(t,0)}function r(){if(a)clearInterval(a),a=null;if(u)clearTimeout(u),u=null;if(window.removeEventListener)window.removeEventListener("hashchange",t,!1);else if("onhashchange"in window&&document.documentMode>7)window.detachEvent("onhashchange",t)}function i(t,i){var o=s!==t;if(o&&e()!==t)if(i.silent)r(),location.hash=t,n(!1);else location.hash=t;return s=t,o}var o={},s="",a=0,u=1;return o.start=function(){n(!0)},o.stop=r,o.resolveURL=function(e){if(e+="",0===e.indexOf("#"))e=e.slice(1);if(!e||"/"===e)e=require("./config").indexURL;return e},o.redirect=function(e,t){t=t||{},e=o.resolveURL(e);var n=s,r=i(e,t),a=r||t.force;if(a){if(!t.silent)o.fire("redirect",{url:e,referrer:n});require("./events").fire("redirect",{url:e,referrer:n})}return a},o.reload=function(){if(s)o.redirect(s,{force:!0})},require("mini-event/EventTarget").enable(o),o});