define(function(){function e(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest;else return void 0}var exports={};return exports.imgRequest=function(e){var t=document.createElement("img");t.src=e},exports.jsonp=function(e,t){function i(){return(new Date).getTime()}function n(){return Math.random().toString().substr(2)}function r(e){if(e){var t=e.parentNode;if(t&&11!==t.nodeType)t.removeChild(e)}}function a(e){var t="";if("string"==typeof e)t=e;else if("object"==typeof e)for(var n in e)t+="&"+n+"="+encodeURIComponent(e[n]);return t+="&_time="+i(),t=t.substr(1)}function o(e,o,s,l){var u,d=o.op,c=o.l;o=null,e=e+(-1===e.indexOf("?")?"?":"&")+a(o);var f=/callback=(\w+)/.exec(e);if(f&&f[1])u=f[1];else u="jsonp_bridge_"+i()+"_"+n(),e=e.replace("?","?"+t.key+"="+u+"&");var h=document.createElement("script");h.type="text/javascript",h.src=e,h.id="id_"+u,h.charset="utf-8";var p=(i(),0),g=null;if(window[u]=function(e){clearTimeout(g),window[u]=void 0;var t=document.getElementById("id_"+u);setTimeout(function(){r(t)},0),s(e)},"onerror"in h)h.onerror=function(){l&&l(),r(h)};var v=3e3;if(1===c)v+=2e4;g=setTimeout(function(){if(0===p)l&&l(),r(h)},v);var m=document.getElementsByTagName("head")[0];if(m)if(3===d||1===d)m.appendChild(h);else setTimeout(function(){m.appendChild(h)},0)}o(e,t,t.success,t.failure)},exports.request=function(t,i){var n=e();return n.open(i.method||"GET",t),n.onreadystatechange=function(){if(4==n.readyState)if(n.status>=200&&n.status<300||304==n.status){if(i.success)i.success(n.responseText)}else if(i.failure)i.failure()},n.send(i.data),n},exports.upload=function(e,t,i,n,r){function a(){n(),c.onload=function(){},c.parentNode.removeChild(c)}function o(){r(),c.onerror=function(){},c.parentNode.removeChild(c)}if("/"==e.charAt(0))e=location.protocol+"//"+location.host+e;if("[object String]"===Object.prototype.toString.call(t)){var s=t;clouda.device.fs.post(s,e,{onsuccess:function(e){if(n)n(e)},onfail:function(){if(r)r()},uploadKey:i,param:{}})}else if(t.nodeName){var l=(t.getElementsByTagName("input")[0],"upload_iframe"+parseInt(1e4*Math.random(),10)),u='<iframe id="'+l+'" name="'+l+'" width="0" height="0" border="0" style="width: 0; height: 0; border: none;">',d=document.createElement("div");d.innerHTML=u;var c=d.getElementsByTagName("iframe")[0];if(document.body.appendChild(c),t.setAttribute("target",l),t.setAttribute("action",e),t.setAttribute("method","post"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),c.attachEvent)c.attachEvent("onload",a),c.attachEvent("onerror",o);else c.onload=a,c.onerror=o;t.submit()}else if(window.FormData){var f=new FormData;f.append(i,t),exports.request(e,{success:n,failure:r,data:f,method:"post"})}},exports});