define(function(require){function e(e,n,t){u.emit(s.BEFORE,e,n,t)}function n(e,n,t){u.emit(s.AFTER,e,n,t)}function t(e){var n={},t=[];if(/@class/.test(e))n.type="class";else n.type="function";return e.replace(/@param\s+\{\s*(.+)\s*\}\s+(\w+)\s+([^\n]*)\n/,function(e,n,o,r){t.push({type:n,name:o,text:r})}),n.param=t,n}function o(e,n){var t=[],o=e.param,r=0;if(o.length>n.length)r=n.length,t.push({text:"传入参数少于定义参数",data:n});if(o.length<n.length)r=o.length,t.push({text:"传入参数多于定义参数",data:n});else r=o.length;for(var i=0;r>i;i++){f.assert(o[i].type,n[i])}return t}function r(e){return e=e||"",e.replace(/^\s|\s$/g,"")}function i(e){e=e||"";var n=e.split(","),t=r(n[0]||""),o=r(n[1]),i=r(n[2]);n=t.split(".");var a=n[0],u=n[1],f=n[2];return{packageName:a,modName:u,funcName:f,before:o,after:i}}var exports={},a=require("./JointPoint"),u=require("./aopEmitter"),f=require("./commentProcessor"),c=window.console||{};c.log=c.log||function(){};var s=exports.TypeEnum={BEFORE:"type1",AFTER:"type2"};return exports.createAopProxy=function(r,i,u){var f=require("../loader"),s=require("../microPromise/microPromise"),l=function(){var m=this,g=[],p=Array.prototype.slice.call(arguments,0),h=new a(this,p,r,i,u);h.originJointPoint=l.originJointPoint,delete l.originJointPoint;var d={jointPoint:h,microPromise:s};e(r,i,h);for(var v=f.getInjection(r)||{},y=v[i||"constructor"]||[],N=0;N<y.length;N++){var P=y[N];if(P in d)g.push(d[P]);else P&&g.push(f.get(P))}if(g=g.concat(p),window.__bullDebug)if(u.__comment){var E=t(u.__comment);o(E,g)}else{if(!u.__bullCommentLogged)c.log("加个注释呗，前人栽树，后人乘凉~ 模块: "+r+" 方法: "+i);u.__bullCommentLogged=!0}var H=u.apply(m,g);if(H&&H.then)H.then(function(e){h.setReturnValue(e),n(r,i,h)});else h.setReturnValue(H),n(r,i,h);return H};for(var m in u)if(u.hasOwnProperty(m))l[m]=u[m];return l},exports.aspectRegister=function(e,n,t){var o=require("../loader");if(-1===e.indexOf("."))e=n+"."+e;for(var r=0;r<t.length;r++)!function(n){n.before&&u.on(s.BEFORE,n.packageName+"."+n.modName,n.funcName,{modName:e,funcName:n.before,func:function(t){var r=t.getThis(),i=t.getArgs(),a=o.get(e),u=null;if("function"==typeof a)u=a.prototype[n.before];else u=a[n.before];if(!u)throw'module "'+e+"\" don't have method "+n.before;u.originJointPoint=t,u.apply(r,i)}}),n.after&&u.on(s.AFTER,n.packageName+"."+n.modName,n.funcName,{modName:e,funcName:n.after,func:function(t){var r=t.getThis(),i=t.getArgs(),a=o.get(e),u=null;if("function"==typeof a)u=a.prototype[n.after];else u=a[n.after];if(!u)throw'module "'+e+"\" don't have method "+n.after;u.originJointPoint=t,u.apply(r,i)}})}(i(t[r]))},exports});