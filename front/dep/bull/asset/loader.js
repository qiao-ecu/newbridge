define(function(require){function e(n,t){var o;if("function"==typeof t){e(n,t.prototype);var r=s(n,i,t);return r.prototype=t.prototype,r.prototype.constructor=r,r}else{for(var i in t)if(t.hasOwnProperty(i)){if(o=t[i],"function"==typeof o)t[i]=s(n,i,o)}else;return t}}function n(e){e=e||[];for(var n=0;n<e.length;n++)exports.init(e[n])}function t(n,t){for(var o in n)if(n.hasOwnProperty(o)){var r=n[o];if(o=t+"."+o,i.hasOwnProperty(o)){if(r._belong&&o!==r._belong)throw'module conflict: module "'+o+'" is already register to "'+r._belong+'"'}else{if(r._belong)throw'module "'+o+'" already register to "'+r._belong+'"';r._belong=o,i[o]=e(o,r)}}else;}function o(e,n){e=e||[];for(var t=0;t<e.length;t++){var o=e[t];a[o.id]=a[o.id]||{};var r=a[o.id],i=o.method;for(var f in i)r[f]=i[f]}}function r(e,n){for(var t=0;t<e.length;t++){var o=e[t];u(o.id,n,o.pointCut)}}var exports={},i={},a={},f=require("./aop/main"),s=f.createAopProxy,u=f.aspectRegister;return exports.init=function(e){if(!e._initialized){e._initialized=!0;var i=e["package"];if(!i&&(e.resource||e.aspect))throw"package name not found";n(e.importConfig),e.resource&&t(e.resource,i),e.aspect&&r(e.aspect,i),e.injection&&o(e.injection,i)}},exports.getInjection=function(e){return a[e]},exports.getDeps=function(e){var n=a[e],t={};for(var o in n)if(n.hasOwnProperty(o))for(var r=n[o],i=0;i<r.length;i++)t[r[i]]=!0;delete t[e];var f=[];for(var o in t)if(o.indexOf(".")>-1)f.push(o);return f},exports.queryDep=function(e){var n=exports.getDeps(e);if(console.log("deps of "+e+" is:"),!n.length)console.log("none");for(var t=0;t<n.length;t++)console.log(n[t]);console.log("-----------------------------------")},exports.getModules=function(e){e=e||"";var n=[];for(var t in i)if(i.hasOwnProperty(t))if(e){if(t.indexOf(e)>-1)n.push(t)}else n.push(t);return n},exports.queryModule=function(e){var n=exports.getModules(e);if(e)console.log('modules contains "'+e+'":');else console.log("all modules:");for(var t=0;t<n.length;t++)console.log(n[t]);console.log("-----------------------------------")},exports.queryInvoke=function(e){var n=[],t={};for(var o in a)if(a.hasOwnProperty(o)){var r=a[o];for(var i in r)if(r.hasOwnProperty(i))for(var f=r[i],s=0;s<f.length;s++){var u=f[s];if(u===e){var l=o+u;if(l in t)continue;else t[l]=!0;n.push({modName:o,funcName:i})}}}if(n.length){console.log("module "+e+" used by these method:");for(var s=0;s<n.length;s++)console.log(n[s].modName+" -> "+i)}else console.log("module"+e+" used nowhere");console.log("-----------------------------------")},exports.checkDep=function(){var e,n=0;console.log("checking deps:");for(var t in i)if(i.hasOwnProperty(t)){e=exports.getDeps(t);for(var o=0;o<e.length;o++)if(!exports.has(e[o]))if(e[o].indexOf(".")>-1)n++,console.log(e[o]+" is required by "+t+" but now missing")}if(!n)console.log("all dependencies is ready");console.log("-----------------------------------")},exports.has=function(e){return e in i},exports.get=function(e){if(e in i)return i[e];else throw'module "'+e+'" not found'},exports});