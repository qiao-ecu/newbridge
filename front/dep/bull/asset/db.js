define(function(require){function e(e){for(var n=[],t=0;t<o.length;t++){var r=o[t];if(r in e){var i=e[r];n.push(r+":"+i)}}return n.join(",")}var exports={},n=[],t={},r={},o=[];return exports.add=function(e){for(var i=0;i<o.length;i++){var a=o[i];t[a][e[a]]=!0}n.push(e),r={}},exports.query=function(i){var a,f=n,u=e(i);if(u in r)return r[u];for(var c=0;c<o.length;c++){var s=o[c];if(s in i){a=[];var l=i[s];if("*"!==l){if(!(l in t[s])){f=[];break}for(var m=0;m<f.length;m++)if(f[m][s]===l)a.push(f[m]);if(!a.length)break;f=a}else;}else;}return r[u]=f,f},exports.init=function(e){if(e=e||[],!e.length)throw"needs schema";o=e;for(var n=0;n<e.length;n++)t[e[n]]={}},exports});