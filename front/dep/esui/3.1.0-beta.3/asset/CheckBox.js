define(function(require){function e(e){var t=r.g(this.boxId).checked;this.setProperties({checked:t})}function t(){i.apply(this,arguments)}var n=require("underscore"),r=require("./lib"),i=require("./InputControl");return t.prototype={type:"CheckBox",createMain:function(){return document.createElement("label")},getCategory:function(){return"check"},initOptions:function(e){var t={value:this.main.value||"on",checked:this.main.checked||!1};n.extend(t,e),t.name=t.name||this.main.getAttribute("name");var r=t.datasource;if(delete t.datasource,this.setProperties(t),null!=r)if(n.isArray(r))this.checked=n.any(r,function(e){return e.value==this.value},this);else if(this.rawValue==r)this.checked=!0;if(!this.title)this.title=this.main.title||("on"===this.getValue()?"":this.getValue())},initStructure:function(){if("input"===this.main.nodeName.toLowerCase())this.boxId=this.main.id||this.helper.getId("box"),this.helper.replaceMain(),this.main.id=this.helper.getId();else this.boxId=this.helper.getId("box");var e='<input type="checkbox" name="${name}" id="${id}" /><span id="${textId}"></span>';this.main.innerHTML=r.format(e,{name:this.name,id:this.boxId,textId:this.helper.getId("text")})},initEvents:function(){var t=r.g(this.boxId);if(this.helper.addDOMEvent(t,"click",function(n){if(this.fire("click"),!t.addEventListener)e.call(this,n)}),t.addEventListener)this.helper.addDOMEvent(t,"change",e)},setProperties:function(e){var t=i.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("checked"))this.fire("change")},getFocusTarget:function(){var e=r.g(this.boxId);return e},updateTitle:function(e){this.title=e,e=n.escape(e),this.helper.getPart("text").innerHTML=e,r.setAttribute(this.boxId,"title",e)},repaint:require("./painters").createRepaint(i.prototype.repaint,{name:["rawValue","checked"],paint:function(e,t,n){var i=e.stringifyValue(t),e=r.g(e.boxId);e.value=i,e.checked=n}},{name:["disabled","readOnly"],paint:function(e,t,n){var e=r.g(e.boxId);e.disabled=t,e.readOnly=n}},{name:"title",paint:function(e,t){e.updateTitle(t)}}),setChecked:function(e){this.setProperties({checked:e})},isChecked:function(){if(this.helper.isInStage("RENDERED")){var e=r.g(this.boxId);return e.checked}else return this.checked}},r.inherits(t,i),require("./main").register(t),t});