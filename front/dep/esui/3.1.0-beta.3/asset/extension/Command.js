define(function(require){function e(e){if(e=e||{},!e.events)e.events=["click"];else e.events=i.splitTokenList(e.events);n.apply(this,arguments)}var t=require("underscore"),i=require("../lib"),n=require("../Extension");return e.prototype.type="Command",e.prototype.handleCommand=function(e){for(var t=e.target,i=this.main&&this.main.parentNode;t&&t!==i;){if(1===t.nodeType&&(t.disabled!==!0||"click"!==e.type)){var n=t.getAttribute("data-command");if(n){var r=t.getAttribute("data-command-args"),a=require("mini-event").fromDOMEvent(e,"command",{name:n,triggerType:e.type,args:r});if(a=this.fire("command",a),a.isPropagationStopped())return}}t=t.parentNode}},e.prototype.activate=function(){for(var e=0;e<this.events.length;e++)this.target.helper.addDOMEvent(this.target.main,this.events[e],this.handleCommand);n.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){for(var e=0;e<this.events.length;e++)this.target.helper.removeDOMEvent(this.target.main,this.events[e],this.handleCommand);n.prototype.inactivate.apply(this,arguments)},e.createDispatcher=function(e){var n=e;if(t.isArray(e)){n={};for(var r=0;r<e.length;r++){var a=e[r],o=a.triggerType?a.triggerType+":"+a.name:a.name;n[o]=a.handler}}return function(e){var t=n[e.triggerType+":"+e.name];if(!t)t=n[e.name];if(!t){var r="execute"+i.pascalize(e.name)+i.pascalize(e.triggerType);t=this[r]}if("function"!=typeof t){var r="execute"+i.pascalize(e.name);t=this[r]}if("function"!=typeof t)t=n[e.triggerType+":*"];if(!t)t=n["*"];if("function"==typeof t)t.apply(this,arguments)}},i.inherits(e,n),require("../main").registerExtension(e),e});