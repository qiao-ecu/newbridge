define(function(require){function e(e,t){return C.getId(e,t)}function t(e,t){return C.getPartClasses(e,t).join(" ")}function i(e,t){return w.getAttribute(e,"data-"+t)}function n(e,t,i){w.setAttribute(e,"data-"+t,i)}function r(e){return!("undefined"==typeof e||null===e)}function a(t,i){return e(t,"subrow")+i}function o(t,i){return e(t,"subentry")+i}function s(e,t){return{subrow:e.subrow&&"false"!=e.subrow}}function l(e,t){d(this,e)}function d(e,t){var i=/subentry-opened/.test(t.className),n="subentry-hover";if(i)n="subentry-opened-hover";C.addPartClasses(e,n,t)}function u(e,t){c(this,e)}function c(e,t){C.removePartClasses(e,"subentry-hover",t),C.removePartClasses(e,"subentry-opened-hover",t)}function h(e,t){var n=this,r=i(e,"index"),a=n.datasource,o=a instanceof Array&&a.length;if(o&&!(r>=o)){if(!i(e,"subrowopened")){var s=a[r],l={index:r,item:s};if(l=n.fire("subrowopen",l),!l.isDefaultPrevented())p(n,r,e)}else f(n,r,e);d(n,e)}}function f(e,t,i){var r={index:t,item:e.datasource[t]};if(r=e.fire("subrowclose",r),!r.isDefaultPrevented())return c(e,i),e.subrowIndex=null,C.removePartClasses(e,"subentry-opened",i),C.removePartClasses(e,"row-unfolded",e.getRow(t)),n(i,"title",e.subEntryOpenTip),n(i,"subrowopened",""),w.g(a(e,t)).style.display="none",!0;else return!1}function p(e,t,i){var s=e.subrowIndex,l=1;if(r(s))l=f(e,s,w.g(o(e,s)));if(l)C.addPartClasses(e,"subentry-opened",i),C.addPartClasses(e,"row-unfolded",e.getRow(t)),n(i,"title",e.subEntryCloseTip),n(i,"subrowopened","1"),w.g(a(e,t)).style.display="",e.subrowMutex&&(e.subrowIndex=t)}function g(e,i,n,r,a,s){var l=s.subrow,d=l&&n.subEntry,u={notInText:!0,width:e.subEntryWidth,align:"right"};if(d){var c="function"==typeof n.isSubEntryShow?n.isSubEntryShow.call(e,i,r,a):!0;if(c!==!1)u.html=w.format(T,{className:t(e,"subentry"),id:o(e,r),title:e.subEntryOpenTip,index:r});u.colClass=t(e,"subentryfield")}return u}function v(e,i,n){var r=e.datasource?e.datasource.length:0;return n.subrow?'<div id="'+a(e,i)+'" class="'+t(e,"subrow")+" "+(r===i+1?t(e,"subrow-last"):"")+'" style="display:none"></div>':""}function m(e,t){return w.g(a(e,t))}function y(t,i){var n=m(t,i),r=e(t,"subrow-panel-"+i),a=t.viewContext.get(r);if(!a)n.innerHTML=w.format(E,{id:r,index:i}),t.initChildren(n),a=t.viewContext.get(r),t.addChild(a);return a}function x(){b.apply(this,arguments)}var b=require("../Extension"),w=require("../lib"),C=require("../controlHelper"),P=require("../main"),I=require("../Table"),T='<div class="${className}" id="${id}" title="${title}" data-index="${index}"></div>',E='<div data-ui="type:Panel;id:${id}" data-index="${index}"></div>';return x.prototype.type="TableSubrow",x.prototype.activate=function(){var e=this.target;if(e instanceof I){var t=C.getPartClasses,i=t(e,"subentry")[0];e.addRowBuilders([{index:0,getRowArgs:s,getColHtml:g,getSubrowHtml:v}]),e.addHandlers("click",{handler:h,matchFn:i}),e.addHandlers("mouseover",{handler:l,matchFn:i}),e.addHandlers("mouseout",{handler:u,matchFn:i}),e.getSubrow=function(e){return m(this,e)},e.setSubrowContent=function(e,t){var i=y(this,t);if(i)i.set("content",e)},e.getSubrowContainer=function(e){return y(this,e)},b.prototype.activate.apply(this,arguments)}},x.prototype.inactivate=function(){var e=this.target;if(e instanceof I)delete e.getSubrow,b.prototype.inactivate.apply(this,arguments)},w.inherits(x,b),P.registerExtension(x),x});