define(function(require){function e(){a.apply(this,arguments)}function t(e,t,i){var n=t&&t.panel&&r.g(t.panel);if(n){var a=i?"removePartClasses":"addPartClasses";e.helper[a]("panel-hidden",n)}}function i(e){for(var i="",n=0;n<e.steps.length;n++){var r=e.steps[n],a=e.helper.getPartClasses("node");if(0===n)a.push.apply(a,e.helper.getPartClasses("node-first"));if(n===e.steps.length-1&&!e.finishText)a.push.apply(a,e.helper.getPartClasses("node-last"));if(n===e.activeIndex-1)a.push.apply(a,e.helper.getPartClasses("node-active-prev"));if(n<=e.activeIndex-1)a.push.apply(a,e.helper.getPartClasses("node-done"));var o=n===e.activeIndex;if(t(e,r,o),o)if(a.push.apply(a,e.helper.getPartClasses("node-active")),n===e.steps.length-1)a.push.apply(a,e.helper.getPartClasses("node-last-active"));i+='<li class="'+a.join(" ")+'">',i+=e.getNodeHTML(r),i+="</li>"}if(e.finishText){var a=[].concat(e.helper.getPartClasses("node"),e.helper.getPartClasses("node-last"),e.helper.getPartClasses("node-finish"),e.activeIndex===e.steps.length?e.helper.getPartClasses("node-active"):[]);i+='<li class="'+a.join(" ")+'">',i+="<span>"+e.finishText+"</span>",i+="</li>"}return i}var n=require("underscore"),r=require("./lib"),a=require("./Control");e.prototype.type="Wizard",e.prototype.createMain=function(){return document.createElement("ol")},e.prototype.initOptions=function(e){var t={steps:[],activeIndex:0},i=r.getChildren(this.main);if(!e.steps&&i.length)t.steps=n.map(i,function(e){var t={text:r.getText(e)},i=e.getAttribute("data-for");if(i)t.panel=i;return t});if(n.extend(t,e),"string"==typeof t.activeIndex)t.activeIndex=+t.activeIndex;this.setProperties(t)},e.prototype.nodeTemplate="<span>${text}</span>",e.prototype.getNodeHTML=function(e){return r.format(this.nodeTemplate,{text:r.encodeHTML(e.text)})};var o=require("./painters");return e.prototype.repaint=o.createRepaint(a.prototype.repaint,{name:["steps","finishText"],paint:function(e){e.main.innerHTML=i(e)}},{name:"activeIndex",paint:function(e,i){if(e.helper.isInStage("RENDERED"))for(var n=e.main.getElementsByTagName("li"),r=n.length-1;r>=0;r--){var a=r===e.activeIndex;t(e,e.steps[r],a);var o=n[r],s=a?"addPartClasses":"removePartClasses";if(e.helper[s]("node-active",o),r===e.steps.length-1)e.helper[s]("node-last-active",o);var l=r<=e.activeIndex-1,s=l?"addPartClasses":"removePartClasses";e.helper[s]("node-done",o);var d=r===e.activeIndex-1,s=d?"addPartClasses":"removePartClasses";e.helper[s]("node-active-prev",o)}}}),e.prototype.setProperties=function(e){if(e.hasOwnProperty("steps")){if(e.hasOwnProperty("activeIndex"))this.activeIndex=e.activeIndex,delete e.activeIndex;else this.activeIndex=0;if(e.hasOwnProperty("finishText"))this.finishText=e.finishText,delete e.finishText}var t=a.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("steps")||t.hasOwnProperty("activeIndex"))this.fire("enter")},e.prototype.getActiveStep=function(){return this.get("steps")[this.get("activeIndex")]},e.prototype.stepNext=function(){var e=this.finishText?this.steps.length:this.steps.length-1;if(this.activeIndex<e)this.set("activeIndex",this.activeIndex+1)},e.prototype.stepPrevious=function(){if(this.activeIndex>0)this.set("activeIndex",this.activeIndex-1)},require("./main").register(e),r.inherits(e,a),e});