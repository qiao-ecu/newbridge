define(function(require){function e(){w.apply(this,arguments)}function t(e){return x.g(P.getId(e,"mat"))}function i(e){return x.g(P.getId(e,"minibar"))}function n(e){var t=x.dom.first(e.main);if(t){x.addClasses(t,P.getPartClasses(e,"head")),e.headEl=t;var i=x.dom.next(t);if(i){e.bodyEl=i,x.addClasses(i,P.getPartClasses(e,"body"));var n=new C({main:i,renderOptions:e.renderOptions});e.addChild(n,"content"),n.render()}}}function r(e){var t=e,i=document.createElement("div"),n=P.getPartClasses(t,"mat");i.id=P.getId(t,"mat"),i.className=n.join(" "),document.body.appendChild(i)}function a(e){var t=e,i=document.createElement("div"),n=[],r=P.getPartClasses(t,"minibar-text");t.headEl&&n.push('<div class="'+r.join(" ")+'">'+t.headEl.innerHTML+"</div>");var a=P.getPartClasses(t,"minibar-arrow");n.push('<div class="'+a.join(" ")+'"></div>'),i.innerHTML=n.join(""),i.id=P.getId(t,"minibar"),i.className=P.getPartClasses(t,"minibar").join(" "),P.addDOMEvent(t,i,"mouseover",x.bind(h,null,t,i)),P.addDOMEvent(t,i,"mouseout",x.bind(f,null,t,i)),document.body.appendChild(i)}function o(e){var t=e,i=t.main;require("./Button");var n=b.create("Button",{id:P.getId(t,"autohide"),skin:"autohide"}),r=b.create("Button",{id:P.getId(t,"fixed"),skin:"fixed"});n.appendTo(i),r.appendTo(i),t.addChild(n,"btnAutoHide"),t.addChild(r,"btnFixed"),n.onclick=x.curry(g,t),r.onclick=x.curry(p,t)}function s(e){var n=e,r=x.page.getScrollTop(),a=n.marginTop||0,o=Math.max(n.top+a-r,a),s=n.main,l=t(n),u=i(n);s.style.top=o+"px",u.style.top=o+"px",l.style.top=o-a+"px"}function l(e){var t=e,n=t.main;n.style.cssText+=";left: "+(t.marginLeft?t.marginLeft+"px":0)+";bottom:"+(t.marginBottom?t.marginBottom+"px":0)+";";var r=t.bodyEl;r.style.top=t.headHeight?t.headHeight+"px":0;var a=i(t);a.style.bottom=t.marginBottom?t.marginBottom+"px":0,s(t)}function u(e){t(e).style.display="none"}function d(e){if(t(e).style.display="block",e.main.style.display="block",i(e).style.display="none",!e.isAutoHide())u(e)}function c(e){u(e),e.main.style.display="none",i(e).style.display="block"}function h(e,t){var i=e,n=P.getPartClasses(i,"minibar-hover");if(!x.hasClass(t,n[0]))x.addClasses(t,n),i.minibarDisplayTick=setTimeout(function(){d(i)},i.autoDelay)}function f(e,t){var i=e,n=P.getPartClasses(i,"minibar-hover");x.removeClasses(t,n),clearTimeout(i.minibarDisplayTick)}function p(e){e.setMode("fixed")}function g(e){e.setMode("autohide")}function v(e,t){var i=e;if(t=t.toLowerCase(),"fixed"==t)i.getChild("btnAutoHide").show(),i.getChild("btnFixed").hide();else i.getChild("btnAutoHide").hide(),i.getChild("btnFixed").show();i.mode=t}function m(e){clearTimeout(e.minibarDisplayTick)}function y(e,t){var i=e;if(e.isAutoHide()){t=t||window.event;var n=t.relatedTarget||t.toElement;if(!x.dom.contains(e.main,n))i.minibarDisplayTick=setTimeout(function(){c(i)},i.autoDelay)}}var x=require("./lib"),w=require("./Control"),b=require("./main"),C=require("./Panel"),P=require("./controlHelper");return e.prototype.type="Sidebar",e.prototype.createMain=function(e){if(!e.tagName)return w.prototype.createMain.call(this);else return document.createElement(e.tagName)},e.prototype.initOptions=function(e){var t={headHeight:37,marginTop:10,marginLeft:10,marginBottom:10,autoDelay:300,mode:"fixed"};x.extend(t,e);var i=this.main,n=i.parentNode,r=x.getOffset(n),a=x.getOffset(i);if(null==this.initialOffsetTop)this.initialOffsetTop=a.top-r.top,t.top=a.top,t.left=a.left;else t.top=r.top+this.initialOffsetTop;x.extend(this,t)},e.prototype.initStructure=function(){if(n(this),r(this),a(this),o(this),!x.ie||x.ie>=7)this.topReset=x.curry(s,this),x.on(window,"scroll",this.topReset);if(l(this),this.isAutoHide())c(this)},e.prototype.initEvents=function(){this.helper.addDOMEvent(this.main,"mouseover",x.bind(m,null,this)),this.helper.addDOMEvent(this.main,"mouseout",x.bind(y,null,this))},e.prototype.repaint=P.createRepaint(w.prototype.repaint,{name:"mode",paint:function(e,t){if(v(e,t),e.isAutoHide())c(e);else d(e);if(P.isInStage(e,"RENDERED"))e.fire("modechange",{mode:t})}}),e.prototype.setMode=function(e){this.setProperties({mode:e})},e.prototype.getMode=function(){return this.mode},e.prototype.getPanel=function(){return this.getChild("content")},e.prototype.setContent=function(e){var t=this.getPanel();if(t)t.setProperties({content:e})},e.prototype.isAutoHide=function(){return"autohide"==this.mode},e.prototype.dispose=function(){if(!P.isInStage(this,"DISPOSED")){if(P.beforeDispose(this),this.topReset)x.un(window,"scroll",this.topReset),this.topReseter=null;var e=t(this),n=i(this);document.body.removeChild(n),document.body.removeChild(e),this.headEl=null,this.bodyEl=null,P.dispose(this),P.afterDispose(this)}},x.inherits(e,w),b.register(e),e});