define(function(require){function e(e){m.apply(this,arguments)}function t(e){var t=e.main;if(t){for(var n,i=v.getChildren(t),r=i.length,o={};r--;)if(n=i[r].getAttribute("data-role"))o[n]=i[r];e.roles=o}}function n(e,t){var n="title",i="close-icon",r='<div class="${clsClass}" id="${clsId}">&nbsp;</div>',o="";if(e.closeButton)o=v.format(r,{clsId:g.getId(e,i),clsClass:g.getPartClasses(e,i).join(" ")});var a='<div id="${titleId}" class="${titleClass}"></div>${closeIcon}',s=[].concat(g.getPartClasses(e,"head")),u={titleId:g.getId(e,n),titleClass:g.getPartClasses(e,n).join(" "),closeIcon:o},c=v.format(a,u);if(t)e.title=t.innerHTML;else if(t=document.createElement("div"),e.main.firstChild)v.insertBefore(t,e.main.firstChild);else e.main.appendChild(t);t.innerHTML=c,v.addClasses(t,s);var l={main:t,renderOptions:e.renderOptions},f=y.create("Panel",l);return f.render(),e.addChild(f,"head"),f}function i(){var e=this.fire("beforeclose");if(e.isDefaultPrevented())return!1;if(this.hide(),this.fire("close"),this.closeOnHide)this.dispose()}function r(){var e=v.page,t=this.main,n=this.left,i=this.top,r=this.right,o=this.bottom;if(void 0===n||null===n)n=(e.getViewWidth()-t.offsetWidth)/2;if(0>n)n=0;if(void 0===i||null===i)i=(e.getViewHeight()-t.offsetHeight)/2;if(i=Math.max(i,0),t.style.left=n+"px",t.style.top=e.getScrollTop()+i+"px",void 0!==r&&null!==r)t.style.left="auto",t.style.right=r+"px";if(void 0!==o&&null!==o)t.style.bottom=o+"px";if("auto"===this.height){var a=e.getViewHeight()-i;t.style.height=a+"px";var s=this.getBody().main,u=this.getHead().main,c=parseInt(v.getStyle(u,"height"),10);s.style.height=a-c+"px"}}function o(e,t){var n=e,i=e.getChild("head").main;if(t===!0)g.removeDOMEvent(n,i,"mousedown",s);else g.addDOMEvent(n,i,"mousedown",s)}function a(e,t,n){if(n)g.addDOMEvent(e,t,"selectstart",function(e){e.preventDefault()});else g.removeDOMEvent(e,t,"selectstart")}function s(e){var t=e.button,n=!1;if(!e.which&&1===t||1===e.which)n=!0;if(n){var i=document;this.addState("dragging"),a(this,this.main,!0),g.addDOMEvent(this,i,"mousemove",u),g.addDOMEvent(this,i,"mouseup",c),v.event.getMousePosition(e),this.dragStartPos={x:e.pageX,y:e.pageY}}}function u(e){var t=this;v.event.getMousePosition(e);var n={x:e.pageX-t.dragStartPos.x,y:e.pageY-t.dragStartPos.y};t.dragStartPos={x:e.pageX,y:e.pageY};var i=t.main,r=v.getOffset(i),o=r.left+n.x,a=r.top+n.y,s=v.page.getWidth(),u=v.page.getHeight(),c=v.getOffset(i);if(0>a)a=0;else if(a>u-c.height)a=u-c.height;if(0>o)o=0;else if(o>s-c.width)o=s-c.width;i.style.left=o+"px",i.style.top=a+"px"}function c(e){g.removeDOMEvent(this,document,"mousemove",u),g.removeDOMEvent(this,document,"mouseup",c),this.removeState("dragging"),a(this,this.main,!1)}function l(e,t){var n=p(e),i=[],r=g.getPartClasses(e,"mask").join(" ");i.push(r),n.className=i.join(" "),n.style.display="block",n.style.zIndex=t}function f(e){var t=p(e);if("undefined"!=typeof t)v.removeNode(t)}function h(e){var t=document.createElement("div");t.id=e,document.body.appendChild(t)}function p(e){var t=g.getId(e),n=w+"-"+t,i=v.g(n);if(!i)h(n);return v.g(n)}require("./Button"),require("./Panel");var d,v=require("./lib"),g=require("./controlHelper"),m=require("./Control"),y=require("./main"),w="ctrl-mask";return e.OK_TEXT="确定",e.CANCEL_TEXT="取消",e.prototype={type:"Dialog",initOptions:function(e){t(e);var n={closeButton:!0,closeOnHide:!0,draggable:!1,mask:!0,title:"我是标题",content:"<p>我是内容</p>",defaultFoot:'<div class="'+this.helper.getPartClassName("ok-btn")+' ui-button-active" data-ui="type:Button;id:btnFootOk;childName:btnOk;">确定</div><div class="'+this.helper.getPartClassName("cancel-btn")+'" data-ui="type:Button;id:btnFootCancel;childName:btnCancel;">取消</div>',needFoot:!0,roles:{}};if("false"===e.closeOnHide)e.closeOnHide=!1;if("false"===e.closeButton)e.closeButton=!1;if("false"===e.mask)e.mask=!1;if("false"===e.needFoot)e.needFoot=!1;if(v.extend(n,e),n.needFoot)if(!n.foot)n.foot=n.defaultFoot;this.setProperties(n)},initStructure:function(){var e=this.main;if(e.parentNode&&"body"!==e.parentNode.nodeName.toLowerCase())document.body.appendChild(e);if(this.addState("hidden"),n(this,this.roles.title),this.createBF("body",this.roles.content),this.needFoot)this.createBF("foot",this.roles.foot)},initEvents:function(){if(this.closeButton){var e=v.g(g.getId(this,"close-icon"));if(e)g.addDOMEvent(this,e,"click",v.curry(i,this))}},createBF:function(e,t){if(t)this.content=t.innerHTML;else if(t=document.createElement("div"),"body"==e){var n=this.getChild("head");if(n)v.insertAfter(t,n.main);else if(this.main.firstChild)v.insertBefore(t,n,this.main.firstChild);else this.main.appendChild(t)}else this.main.appendChild(t);v.addClasses(t,g.getPartClasses(this,e+"-panel"));var i={main:t,renderOptions:this.renderOptions},r=y.create("Panel",i);return r.render(),this.addChild(r,e),r},repaint:g.createRepaint(m.prototype.repaint,{name:"height",paint:function(e,t){if("auto"===t)e.main.style.height="auto";else if(t)e.main.style.height=t+"px";if(e.isShow)r.apply(e)}},{name:"width",paint:function(e,t){if("auto"===t)e.main.style.width="auto";else if(t)e.main.style.width=t+"px";if(e.isShow)r.apply(e)}},{name:"title",paint:function(e,t){var n=g.getId(e,"title");v.g(n).innerHTML=t}},{name:"content",paint:function(e,t){if(t){var n='<div class="${class}" id="${id}">${content}</div>',i=e.getBody(),r=g.getId(e,"body"),o=g.getPartClasses(e,"body"),a={"class":o.join(" "),id:r,content:t};i.setContent(v.format(n,a))}}},{name:"foot",paint:function(e,t){var n='<div class="${class}" id="${id}">${content}</div>',i=g.getId(e,"foot"),r=g.getPartClasses(e,"foot"),o=e.getFoot();if(null==t){if(e.needFoot=!1,o)e.removeChild(o)}else{e.needFoot=!0;var a={"class":r.join(" "),id:i,content:t};if(!o)o=e.createBF("foot");o.setContent(v.format(n,a))}}},{name:"draggable",paint:function(e,t){var n=!1;if(t)e.addState("draggable");else e.removeState("draggable"),n=!0;o(e,n)}}),getBody:function(){return this.getChild("body")},getHead:function(){return this.getChild("head")},getFoot:function(){return this.getChild("foot")},show:function(){var e=this.mask;if(g.isInStage(this,"INITED"))this.render();else if(g.isInStage(this,"DISPOSED"))return;d=v.curry(r,this),g.addDOMEvent(this,window,"resize",r),this.setWidth(this.width),this.removeState("hidden"),r.apply(this);for(var t=1203,n=document.body.children,i=0,o=0,a=n.length;a>o;o++)if(1===n[o].nodeType)if(v.hasClass(n[o],this.helper.getPrimaryClassName())&&!v.hasClass(n[o],this.helper.getPrimaryClassName("hidden")))i++;if(t+=10*i,this.main.style.zIndex=t,e)l(this,t-1);this.fire("show"),this.isShow=!0},hide:function(){if(this.isShow){g.removeDOMEvent(this,window,"resize",r);var e=this.mask;if(this.addState("hidden"),e)f(this)}this.fire("hide"),this.isShow=!1},setTitle:function(e){this.setProperties({title:e})},setContent:function(e){this.setProperties({content:e})},setFoot:function(e){this.setProperties({foot:e})},setHeight:function(e){this.setProperties({height:e})},setWidth:function(e){this.setProperties({width:e})},resize:function(){r.apply(this)},dispose:function(){if(!this.helper.isInStage("DISPOSED")){this.hide();var e=this.main.id;v.removeNode(e),m.prototype.dispose.apply(this,arguments)}}},e.confirm=function(t){function n(e,t){e.fire(t),e.dispose()}var i="dialog-confirm",r=v.encodeHTML(t.title)||"",o=t.content,a=v.encodeHTML(t.okText)||e.OK_TEXT,s=v.encodeHTML(t.cancelText)||e.CANCEL_TEXT,u={type:"confirm",skin:"confirm",title:""};v.extend(u,t);var c=['<div class="${prefix}-icon ${prefix}-icon-${type}"></div>','<div class="${prefix}-text">${content}</div>'].join("");u.id=g.getGUID(i),u.closeButton=!0,u.mask=!0,u.alwaysTop=!0;var l=u.type;u.type=null;var f=y.create("Dialog",u);f.appendTo(document.body),f.show();var h=f.getFoot().getChild("btnOk"),p=f.getFoot().getChild("btnCancel");if(h.setContent(a),p.setContent(s),f.setTitle(r),f.setContent(v.format(c,{type:l,content:o,prefix:f.helper.getPrimaryClassName()})),u.btnHeight)h.set("height",u.btnHeight),p.set("height",u.btnHeight);if(u.btnWidth)h.set("width",u.btnWidth),p.set("width",u.btnWidth);return h.on("click",v.curry(n,f,"ok")),p.on("click",v.curry(n,f,"cancel")),f},e.alert=function(t){function n(e,t){e.fire("ok"),t.dispose(),e.dispose()}var i="dialog-alert",r="dialog-alert-ok",o=v.encodeHTML(t.title)||"",a=v.encodeHTML(t.content)||"",s=v.encodeHTML(t.okText)||e.OK_TEXT,u={type:"warning",skin:"alert",title:""};v.extend(u,t);var c=['<div class="${prefix}-icon ${prefix}-icon-${type}"></div>','<div class="${prefix}-text">${content}</div>'].join(""),l=g.getGUID(i);u.id=l,u.closeButton=!1,u.mask=!0,u.alwaysTop=!0;var f=u.type;u.type=null;var h=y.create("Dialog",u);h.appendTo(document.body),h.setTitle(o),h.setContent(v.format(c,{type:f,content:a,prefix:h.helper.getPrimaryClassName()})),h.setFoot('<div class="'+h.helper.getPartClassName("ok-btn")+' ui-button-active" data-ui="type:Button;childName:okBtn;id:'+l+"-"+r+'; skin:spring;width:50;">'+s+"</div>"),h.show();var p=h.getFoot().getChild("okBtn");if(p.on("click",v.curry(n,h,p)),u.btnHeight)p.set("height",u.btnHeight);if(u.btnwidth)p.set("width",u.btnwidth);return h},v.inherits(e,m),y.register(e),e});