define(function(require){function e(){a.apply(this,arguments)}function t(e,t){for(var n=e.getElementsByTagName("input"),r=e.getElementsByTagName("label"),i={},a=r.length-1;a>=0;a--){var s=r[a],u=o.getAttribute(s,"for");if(u)i[u]=s}for(var c=[],f=[],a=0,l=n.length;l>a;a++){var p=n[a];if(p.type===t.boxType&&(t.name||"")===p.name){var h={value:p.value},s=p.id&&i[p.id];if(h.title=s?o.getText(s):"",!h.title)h.title=p.title||("on"===p.value?p.value:"");if(c.push(h),null!==p.getAttribute("checked"))f.push(p.value)}}if(t.datasource=c,!t.rawValue&&!t.value)t.rawValue=f}function n(){var e=i.chain(this.getBoxElements()).where({checked:!0}).pluck("value").value();this.rawValue=e,this.fire("change")}function r(e,t,r){e.helper.clearDOMEvents();for(var a="",u=[].concat(e.helper.getPartClasses(r),e.helper.getPartClasses("wrapper")),c=o.toDictionary(e.rawValue),f=e.name||o.getGUID(),l=0;l<t.length;l++){var p=t[l],h={wrapperClass:u.join(" "),id:e.helper.getId("box-"+l),type:e.boxType,name:f,title:o.trim(p.title||p.name||p.text),value:p.value,checked:c[p.value]?' checked="checked"':""};a+=o.format(s,h)}e.main.innerHTML=a;var d=e.main.addEventListener?"change":"click";i.each(e.getBoxElements(),function(e){this.helper.addDOMEvent(e,d,n)},e)}var i=require("underscore"),o=require("./lib"),a=require("./InputControl");e.prototype.type="BoxGroup",e.prototype.initOptions=function(e){var n={datasource:[],orientation:"horizontal",boxType:"radio"};if(i.extend(n,e),!n.datasource.length)t(this.main,n);if(!n.rawValue&&!n.value)n.rawValue=[];this.setProperties(n)};var s=['<label title="${title}" class="${wrapperClass}">','<input type="${type}" name="${name}" id="${id}" title="${title}" value="${value}"${checked} />',"<span>${title}</span>","</label>"];return s=s.join(""),e.prototype.setProperties=function(e){if((e.datasource||e.boxType)&&!e.rawValue&&!e.value&&(!this.rawValue||!this.rawValue.length))e.rawValue=[];var t=a.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("./painters").createRepaint(a.prototype.repaint,{name:["datasource","boxType"],paint:r},{name:["disabled","readOnly"],paint:function(e,t,n){i.each(e.getBoxElements(),function(e){e.disabled=t,e.readOnly=n})}},{name:"rawValue",paint:function(e,t){t=t||[],e.rawValue=t;for(var n={},r=0;r<t.length;r++)n[t[r]]=!0;i.each(e.getBoxElements(),function(e){e.checked=n.hasOwnProperty(e.value)})}},{name:"orientation",paint:function(e,t){e.removeState("vertical"),e.removeState("horizontal"),e.addState(t)}}),e.prototype.parseValue=function(e){return e.split(",")},e.prototype.getBoxElements=function(){return i.where(this.main.getElementsByTagName("input"),{type:this.boxType})},o.inherits(e,a),require("./main").register(e),e});