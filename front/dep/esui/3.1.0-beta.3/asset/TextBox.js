define(function(require){function e(e){d.apply(this,arguments)}function t(e){var t=e.which||e.keyCode;if(13===t)this.fire("enter");var i={keyCode:t,key:String.fromCharCode(t),ctrlKey:e.ctrlKey,altKey:e.altKey},n=require("mini-event").fromDOMEvent(e,"keypress",i);this.fire("keypress",n)}function i(e,t){var i=s.g(e.inputId);if(!u){var n=e.helper.getPart("placeholder");if("boolean"!=typeof t)t=document.activeElement===i;if(!t&&!e.getRawValue())e.helper.removePartClasses("placeholder-hidden",n);else e.helper.addPartClasses("placeholder-hidden",n)}}function n(e){if(i(this,!0),this.autoSelect){var t=s.g(this.inputId);t.select()}this.fire("focus")}function r(e){i(this,!1),this.fire("blur")}function a(e){if("input"===e.type||"value"===e.propertyName)this.fire("input")}var o=require("underscore"),s=require("./lib"),l=require("./main"),d=require("./InputControl"),u="placeholder"in document.createElement("input");return e.defaultProperties={width:200},e.prototype.type="TextBox",e.prototype.initOptions=function(t){var i={mode:"text",placeholder:"",autoSelect:!1};if(o.extend(i,e.defaultProperties),!i.name)i.name=this.main.getAttribute("name");if(s.isInput(this.main)){var n=this.main.nodeName.toLowerCase();if("textarea"===n)i.mode="textarea";else{var r=this.main.type;i.mode="password"===r?"password":"text"}if(!i.placeholder)i.placeholder=this.main.getAttribute("placeholder");this.helper.extractOptionsFromInput(this.main,i)}if(o.extend(i,t),!i.hasOwnProperty("title")&&this.main.title)i.title=this.main.title;this.setProperties(i)},e.prototype.getFocusTarget=function(){return s.g(this.inputId)},e.prototype.initStructure=function(){if(s.isInput(this.main)){var e=this.helper.replaceMain();if(s.removeAttribute(this.main,"tabindex"),this.inputId=e.id||this.helper.getId("input"),this.main.id)this.main.id=this.helper.getId();var t=e.cloneNode(!1);s.removeAttribute(t,l.getConfig("instanceAttr")),t.id=this.inputId,this.main.appendChild(t)}else{this.inputId=this.helper.getId("input");var i="textarea"===this.mode?'<textarea id="'+this.inputId+'"':'<input type="'+this.mode+'" placeholder="'+this.placeholder+'" id="'+this.inputId+'"';if(this.name)i+=' name="'+o.escape(this.name)+'"';i+="textarea"===this.mode?"></textarea>":" />",this.main.innerHTML=i}if(!u){var t=s.g(this.inputId),n=document.createElement("label");n.id=this.helper.getId("placeholder"),s.setAttribute(n,"for",t.id),this.helper.addPartClasses("placeholder",n),s.insertAfter(n,t)}},e.prototype.initEvents=function(){var e=s.g(this.inputId);this.helper.addDOMEvent(e,"keypress",t),this.helper.addDOMEvent(e,"focus",n),this.helper.addDOMEvent(e,"blur",r);var i="oninput"in e?"input":"propertychange";this.helper.addDOMEvent(e,i,a),this.helper.delegateDOMEvent(e,"change")},e.prototype.repaint=require("./painters").createRepaint(d.prototype.repaint,{name:"rawValue",paint:function(e,t){var n=s.g(e.inputId),r="oninput"in n?"input":"propertychange";e.helper.removeDOMEvent(n,r),n.value=e.stringifyValue(t),e.helper.addDOMEvent(n,r,a),i(e)}},{name:"title",paint:function(e,t){var i=s.g(e.inputId),n=e.helper.getPart("placeholder");if(t){if(s.setAttribute(e.main,"title",t),s.setAttribute(i,"title",t),n)s.setAttribute(n,"title",t)}else if(s.removeAttribute(e.main,"title"),s.removeAttribute(i,"title"),n)s.removeAttribute(n,"title")}},{name:"maxLength",paint:function(e,t){var i=s.g(e.inputId);if(t=parseInt(t,10),!t||0>=t){try{i.maxLength=void 0,delete i.maxLength}catch(n){}s.removeAttribute(i,"maxlength"),s.removeAttribute(i,"maxLength")}else i.maxLength=t,s.setAttribute(i,"maxlength",t)}},{name:["disabled","readOnly"],paint:function(e,t,i){var n=s.g(e.inputId);n.disabled=t,n.readOnly=i}},{name:"placeholder",paint:function(e,t){var n=s.g(e.inputId);if(u)if(t)s.setAttribute(n,"placeholder",t);else s.removeAttribute(n,"placeholder");else{var r=e.helper.getPart("placeholder");r.innerHTML=o.escape(t||"")}i(e)}},{name:["hint","hintType"],paint:function(e,t,i){var n=e.helper.getPart("hint");if(e.removeState("hint-prefix"),e.removeState("hint-suffix"),!t&&n)s.removeNode(n);if(t){if(!n)n=document.createElement("label"),n.id=e.helper.getId("hint"),e.helper.addPartClasses("hint",n),s.setAttribute(n,"for",e.inputId);n.innerHTML=o.escape(t),i="prefix"===i?"prefix":"suffix";var r="prefix"===i?"insertBefore":"insertAfter",a=s.g(e.inputId);s[r](n,a),e.addState("hint-"+i)}}},{name:["width","hint","hidden"],paint:function(e,t,i,n){if(!n&&!isNaN(t)){if(i){var r=e.helper.getPart("hint");if(r)t-=r.offsetWidth}var a=s.g(e.inputId);a.style.width=t+"px";var o=e.helper.getPart("placeholder");if(o)o.style.maxWidth=t+"px"}}},{name:"height",paint:function(e,t){if(!isNaN(t)){var i=e.helper.getPart("hint"),n=t+"px";if(i)i.style.height=n,i.style.lineHeight=n;var r=s.g(e.inputId);r.style.height=n;var a=e.helper.getPart("placeholder");if(a)a.style.height=n,a.style.lineHeight=n}}}),e.prototype.getValidityLabel=function(){var e=d.prototype.getValidityLabel.apply(this,arguments);if(e)e.set("targetType","textarea"===this.mode?"TextArea":"TextBox");return e},e.prototype.getRawValue=function(){var e=s.g(this.inputId);return e?e.value:this.rawValue||this.value||""},e.prototype.getRawValueProperty=e.prototype.getRawValue,s.inherits(e,d),l.register(e),e});