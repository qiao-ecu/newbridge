define(function(require){function e(e){this.length=e.length;for(var t=0;t<e.length;t++)this[t]=e[t]}function t(e,t){for(var n={},i=0;i<e.length;i++){var r=e[i];if("check"!==r.getCategory()||r.isChecked())if(!r.isDisabled()){var o=r.get("name"),a=t(r);if(n.hasOwnProperty(o))n[o]=[].concat(n[o],a);else n[o]=a}else;else;}return n}function n(e){s.apply(this,arguments)}function i(e){var t=e.getCategory();return"input"===t||"check"===t}var r=require("underscore"),o=require("./lib"),a=require("./main"),s=require("./Panel");return e.prototype.splice=Array.prototype.splice,e.prototype.getData=function(){return t(this,function(e){return e.getRawValue()})},e.prototype.getDataAsString=function(){var e=t(this,function(e){var t=e.getValue();return encodeURIComponent(t)}),n="";return r.each(e,function(e,t){n+=encodeURIComponent(t)+"="+e}),n},e.prototype.getValueAsString=function(e){var t=this.getData(),n=t[e],i=n?"string"==typeof n?n:n.join(","):"";return i},e.prototype.checkAll=function(){for(var e=0;e<this.length;e++){var t=this[e];if("check"===t.getCategory())t.setChecked(!0)}},e.prototype.uncheckAll=function(){for(var e=0;e<this.length;e++){var t=this[e];if("check"===t.getCategory())t.setChecked(!1)}},e.prototype.checkInverse=function(){for(var e=0;e<this.length;e++){var t=this[e];if("check"===t.getCategory())t.setChecked(!t.isChecked())}},e.prototype.checkByValue=function(e){for(var t=o.toDictionary(e),n=0;n<this.length;n++){var i=this[n];if("check"===i.getCategory()){var r=t.hasOwnProperty(i.getValue());i.setChecked(r)}}},n.defaultProperties={autoValidate:!1},n.prototype.type="Form",n.prototype.validateAndSubmit=function(){var e=this.fire("beforevalidate");if(!e.isDefaultPrevented())try{var t=this.get("autoValidate")?this.validate():!0,e=this.fire("aftervalidate",{isValid:t});if(e.isDefaultPrevented())return;var n={triggerSource:this};if(t)this.fire("submit",n);else this.fire("invalid",n)}catch(i){this.fire("submitfail",{error:i})}},n.prototype.initEvents=function(){if("form"===this.main.nodeName.toLowerCase())this.helper.addDOMEvent(this.main,"submit",function(e){return this.validateAndSubmit(),e.preventDefault(),!1})},n.prototype.createMain=function(e){var t=document.createElement("form");return t.method="POST",t.action=e.action||"",t},n.prototype.initOptions=function(e){var t=r.extend({},n.defaultProperties,e);if("form"===this.main.nodeName.toLowerCase())t.action=this.main.getAttribute("action"),t.method=this.main.getAttribute("method");else t.method=this.method||"POST";if("false"===e.autoValidate)t.autoValidate=!1;else t.autoValidate=!!t.autoValidate;s.prototype.initOptions.call(this,t)},n.prototype.getInputControls=function(t,n){function r(e,s){for(var u=s.children,c=u.length,l=0;c>l;l++){var f=u[l];if(1===f.nodeType){var h=a.getControlByDOM(f);if(h&&i(h)&&h.viewContext===e.viewContext&&h.get("name")&&(!t||h.get("name")===t)&&(!n||h.get("type")===n))o.push(h);else r(e,f)}else;}}var o=[];return r(this,this.main),new e(o)},n.prototype.getData=function(){var e=this.getInputControls();return e.getData()},n.prototype.getDataAsString=function(){var e=this.getInputControls();return e.getDataAsString()},n.prototype.validate=function(){for(var e=this.getInputControls(),t=!0,n=0;n<e.length;n++){var i=e[n];if(!i.isDisabled())t&=i.validate();else;}return!!t},n.prototype.repaint=function(e,t){s.prototype.repaint.apply(this,arguments);var n=!1;if(!t&&this.submitButton)n=!0;if(t&&t.hasOwnProperty("submitButton")){var i=t.submitButton;if(i.oldValue){for(var r=0;r<i.oldValue.length;r++){var o=this.viewContext.get(i.oldValue[r]);if(o)o.un("click",this.validateAndSubmit,this)}n=!!this.submitButton}}if(n)for(var r=0;r<this.submitButton.length;r++){var a=this.viewContext.get(this.submitButton[r]);if(a)a.on("click",this.validateAndSubmit,this)}},n.prototype.setProperties=function(e){e=r.clone(e),e.submitButton=o.splitTokenList(e.submitButton),s.prototype.setProperties.call(this,e)},o.inherits(n,s),a.register(n),n});