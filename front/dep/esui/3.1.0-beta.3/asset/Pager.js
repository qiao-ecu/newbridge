define(function(require){function e(e){var t=['<div id="${pagerWrapperId}" class="${pagerWrapperClass}">','<div id="${selectWrapperId}" ','class="${selectWrapperClass}">','<span id="${labelId}" class="${labelClass}">',"${labelText}</span>",'<div data-ui="type:Select;childName:select;','id:${selectId};width:40;"></div>',"</div>",'<ul id="${mainId}" class="${mainClass}"></ul>',"</div>"];return f.format(t.join(""),{pagerWrapperId:e.helper.getId("pager-wrapper"),pagerWrapperClass:e.helper.getPartClasses(e.layout)[0],selectWrapperId:e.helper.getId("select-wrapper"),selectWrapperClass:e.helper.getPartClassName("select-wrapper"),labelId:e.helper.getId("label"),labelClass:e.helper.getPartClassName("label"),labelText:"每页显示",selectId:e.helper.getId("select"),mainId:e.helper.getId("main"),mainClass:e.helper.getPartClassName("main")})}function t(e){function t(t){return f.format(e.urlTemplate,{page:t,pageSize:e.pageSize})}function i(i,n,r,o){var a={className:e.helper.getPartClassName(i)};if(arguments.length>1)a.link=t(n),a.id=e.helper.getId(r),a.page=n,a.text=o;return a}function n(t,i){if(!i){var n={anchor:a,plain:o};i=n[e.pageType]||n.anchor}return f.format(i,t)}function r(e,t){if("number"==typeof e)e=i("item",e,"page-"+e,e);var r=n(e,t);l.push(r)}var o='<li class="${className}" id="${id}" data-page="${page}">${text}</li>',a='<li class="${className}" id="${id}"><a href="${link}">${text}</a></li>',s='<li class="${className}">…</li>',l=[],u=e.page,c=e.backCount,h=e.forwardCount,p=Math.ceil(e.count/e.pageSize);if(u>1){var d=i("item-extend",u-1,"page-back",e.backText);r(d)}if(u>c+1)if(r(1),u>c+2)d=i("item-omit"),r(d,s);for(var g=u>c?c:u-1,v=u-g;u>v;v++)r(v);for(d=i("item-current",u,"page-"+u,u),r(d,o),g=p-u>h?h:p-u,v=u+1;u+g+1>v;v++)r(v);if(p-h>u){if(p-h-1>u)d=i("item-omit"),r(d,s);r(p)}if(p>u)d=i("item-extend",u+1,"page-forward",e.forwardText),r(d);return l.join("")}function i(e){var i=e.pageSize;i=i>0?i:1,e.pageSize=i,e.getChild("select").set("value",i+"");var n=Math.ceil(e.count/i),r=e.page;r=r>n?n:r,r=r>0?r:1,e.page=r;var o=e.helper.getPart("main");o.innerHTML=t(e)}function n(e,t){function i(){for(var t=[],i=0,n=arguments.length;n>i;i++)t.push(e.helper.getPartClasses(arguments[i])[0]);return t}var n=e.helper.getPart("pager-wrapper");f.removeClasses(n,i("alignLeft","alignLeftReversed","alignRight","alignRightReversed","distributed","distributedReversed")),f.addClass(n,e.helper.getPartClasses(t)[0])}function r(e){var t=e.target,i=this.helper.getId("page-back"),n=this.helper.getId("page-forward"),r=this.page;if(this.helper.isPart(t,"item")||this.helper.isPart(t,"item-extend")){if(t.id===i)r--;else if(t.id===n)r++;else r=+f.getAttribute(t,"data-page");this.set("page",r)}}function o(e){var t=c.map(e,function(e){return{text:e+"",value:e+""}});return t}function a(e){var t=parseInt(this.getChild("select").getValue(),10);this.pageSize=t,i(this),this.fire("changepagesize"),this.fire("pagesizechange")}function s(e){var t=e.helper.getPart("select-wrapper");e.helper.removePartClasses("select-hidden",t)}function l(e){var t=e.helper.getPart("select-wrapper");e.helper.addPartClasses("select-hidden",t)}function u(e){p.apply(this,arguments)}var c=require("underscore"),f=require("./lib"),h=require("./main"),p=require("./Control");return require("./Select"),u.defaultProperties={},u.prototype={type:"Pager",defaultProperties:{pageSizes:[15,30,50,100],pageSize:15},initOptions:function(e){var t={pageType:"anchor",count:0,page:1,backCount:3,forwardCount:3,backText:"上一页",forwardText:"下一页",urlTemplate:"",layout:"alignLeft"};c.extend(t,this.defaultProperties,u.defaultProperties,e),this.setProperties(t)},initStructure:function(){this.main.innerHTML=e(this),this.helper.initChildren();var t=this.getChild("select");if(!this.pageSizes||!this.pageSizes.length)l(this);else{var i={datasource:o(this.pageSizes),value:this.pageSize+""};t.setProperties(i)}a.call(this)},initEvents:function(){var e=this.getChild("select");e.on("change",a,this),this.helper.addDOMEvent("main","click",r)},setProperties:function(e,t){if(e=c.clone(e),e.hasOwnProperty("pageIndex")&&!e.hasOwnProperty("page"))e.page=+e.pageIndex+1;var i=["count","page","backCount","forwardCount","pageSize"];c.each(i,function(t){var i=e[t];if(c.isString(i))e[t]=+i});var n=p.prototype.setProperties.apply(this,arguments);if(n.hasOwnProperty("page")&&!t)this.fire("changepage"),this.fire("pagechange")},repaint:require("./painters").createRepaint(p.prototype.repaint,{name:"pageSizes",paint:function(e,t){var i=e.getChild("select");if(!t||!t.length)l(e);else{var n={datasource:o(t),value:e.pageSize+""};i.setProperties(n),s(e)}}},{name:"layout",paint:n},{name:["pageType","count","pageSize","page","backCount","forwardCount","backText","forwardText","urlTemplate"],paint:i}),getPageIndex:function(){return this.get("page")-1},isLastIndex:function(){var e=this.get("page")+1,t=Math.ceil(this.get("count")/this.get("pageSize"));return e>t?!0:!1}},f.inherits(u,p),h.register(u),u});