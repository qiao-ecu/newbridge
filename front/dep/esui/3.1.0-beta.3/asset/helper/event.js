define(function(require){function e(e){if(e===window)return s.window;if(e===document)return s.document;if(e===document.documentElement)return s.documentElement;if(e===document.body)return s.body;else return null}function t(t,i){var n=e(t);if(n){var r=n[i.type];if(r)l.each(r,function(e){a(e,t,i)})}}function i(e,t){t=t||150;var i=0;return function(n){clearTimeout(i);var r=this;n=n||window.event,n={type:n.type,srcElement:n.srcElement,target:n.target,currentTarget:n.currentTarget},i=setTimeout(function(){e.call(r,n)},t)}}function n(n,r,a){var o=e(a);if(!o)return!1;var s=o[r];if(!s){s=o[r]=[];var d=l.partial(t,a);if("resize"===r||"scroll"===r)d=i(d);s.handler=d,u.on(a,r,s.handler)}if(!(l.indexOf(s,n)>=0))return s.push(n),!0}function r(t,i,n){var r=e(n);if(!r)return!1;if(!r[i])return!0;for(var a=r[i],o=0;o<a.length;o++)if(a[o]===t){a.splice(o,1);break}if(!a.length){var s=a.handler;u.un(n,i,s),r[i]=null}return!0}function a(e,t,i){i=i||window.event;var n=l.any(e.ignoreStates,function(t){return e.hasState(t)});if(!n){if(!i.target)i.target=i.srcElement;if(!i.currentTarget)i.currentTarget=t;if(!i.preventDefault)i.preventDefault=function(){i.returnValue=!1};if(!i.stopPropagation)i.stopPropagation=function(){i.cancelBubble=!0};var r=e.domEvents[i.currentTarget[o]][i.type];if(r)r.execute(i,e)}}var o="_esuiDOMEvent",s={window:{},document:{},documentElement:{},body:{}},l=require("underscore"),d=require("mini-event/EventQueue"),u=require("../lib"),c={};return c.addDOMEvent=function(e,t,i){if("string"==typeof e)e=this.getPart(e);if(!this.control.domEvents)this.control.domEvents={};var r=e[o];if(!r)r=e[o]=u.getGUID();var s=this.control.domEvents[r];if(!s)s=this.control.domEvents[r]={element:e};var c=n(this.control,t,e),h=s[t];if(!h)if(h=s[t]=new d,!c)h.handler=l.partial(a,this.control,e),u.on(e,t,h.handler);h.add(i)},c.delegateDOMEvent=function(e,t,i){var n=function(e){var t=require("mini-event").fromDOMEvent(e);if(this.fire(i||e.type,t),t.isDefaultPrevented())u.event.preventDefault(e);if(t.isPropagationStopped())u.event.stopPropagation(e)};this.addDOMEvent(e,t,n)},c.removeDOMEvent=function(e,t,i){if("string"==typeof e)e=this.getPart(e);if(this.control.domEvents){var n=e[o],a=this.control.domEvents[n];if(a&&a[t])if(!i)a[t].clear();else{var s=a[t];if(s.remove(i),!s.getLength())r(this.control,t,e)}}},c.clearDOMEvents=function(e){if("string"==typeof e)e=this.getPart(e);if(this.control.domEvents){if(!e)return l.each(l.pluck(this.control.domEvents,"element"),this.clearDOMEvents,this),void(this.control.domEvents=null);var t=e[o],i=this.control.domEvents[t];delete i.element,l.each(i,function(t,i){var n=r(this.control,i,e);if(!n){var a=t.handler;t.dispose(),t.handler=null,u.un(e,i,a)}},this),delete this.control.domEvents[t]}},c});