define(function(require){function e(e){var t={followHeightArr:[0,0],followWidthArr:[],handlers:[]};Ae.call(this,Oe.extend({},e,t))}function t(e){return!("undefined"==typeof e||null===e)}function i(e){return!t(e)||!e.toString().length}function n(e,t,i){Ve.setAttribute(e,"data-"+t,i)}function r(e,t){return Ve.getAttribute(e,"data-"+t)}function a(e,t){var i=Ve.getStyle(e,t);return""===i?0:parseInt(i,10)||0}function o(e,t){return Ne.getId(e,t)}function s(e,t){return Ne.getPartClasses(e,t).join(" ")}function l(e){return Ve.g(o(e,"head"))}function d(e){return Ve.g(o(e,"body"))}function u(e){return Ve.g(o(e,"foot"))}function c(e,t){return Ve.g(o(e,"row")+t)}function h(e){return Ve.g(o(e,"select-all"))}function f(e,t){e.selectedIndex=t;for(var i={},n=t.length-1;n>=0;n--)i[t[n]]=1;e.selectedIndexMap=i}function p(e,t){if(e.selectedIndexMap)return!!e.selectedIndexMap[t];else return!1}function g(e){if(e.width)return e.width;var t=document.createElement("div"),i=e.main.parentNode;i.appendChild(t);var n=t.offsetWidth;return t.parentNode.removeChild(t),n}function v(e){if(e.fields){for(var t=e.fields,i=t.slice(0),n=i.length;n--;)if(!i[n])i.splice(n,1);if(e.realFields=i,e.select)switch(e.select.toLowerCase()){case"multi":i.unshift(ue(e));break;case"single":i.unshift(ce(e))}}}function m(e){if(e.followHead)if(x(e),!e.noFollowHeadCache)C(e)}function y(e){if(e.followHead)x(e),C(e)}function x(e){if(e.followHead){for(var t=e.followDoms=[],i=e.main.parentNode.firstChild,n=e.id;i;){if(1===i.nodeType&&r(i,"follow-thead")===n)t.push(i);i=i.nextSibling}b(e),w(e)}}function w(e){var t=e.followDoms,i=e.followHeightArr;i[0]=0;for(var n=0,r=t.length;r>n;n++){var a=t[n];i[n+1]=i[n]+a.offsetHeight}i[n+1]=i[n],i.lenght=n+2}function b(e){for(var t=e.followDoms,i=e.followWidthArr,n=0,r=t.length;r>n;n++){var o=t[n],s=a(o,"padding-left")+a(o,"padding-right")+a(o,"border-left-width")+a(o,"border-right-width");i[n]=s,t[n].style.width=e.realWidth-s+"px"}}function C(e){var t=e.followDoms,i=Ve.getOffset(t[0]||e.main);e.followTop=i.top,e.followLeft=i.left}function P(e){var t=e.realFields,i=[],n=e.fontSize,r=2*e.colPadding+5;if(!e.noHead)for(var a=0,o=t.length;o>a;a++){var s=t[a],l=s.minWidth;if(!l&&!s.breakLine)l=s.title.length*n+r+(e.sortable&&s.sortable?e.sortWidth:0)+(s.tip?e.tipWidth:0);i[a]=l}else for(var d=n+r,a=0,o=t.length;o>a;a++)i[a]=d;e.minColsWidth=i}function I(e){var t=e.realFields,i=[];e.colsWidth=[];for(var n=e.realWidth-1,r=0,a=t.length;a>r;r++){var o=t[r],s=o.width;if(s=s?parseInt(s,10):0,e.colsWidth.push(s),n-=s,!o.stable)i.push(r)}for(var a=i.length,l=Math.round(n/a),r=0;a>r;r++){var d=i[r],u=Math.abs(n)<Math.abs(l)?n:l;n-=u,e.colsWidth[d]+=u;var c=e.minColsWidth[d];if(c>e.colsWidth[d])n+=e.colsWidth[d]-c,e.colsWidth[d]=c}if(0>n)for(var r=0;a>r&&0!==n;){var d=i[r],c=e.minColsWidth[d];if(c<e.colsWidth[d]){var u=e.colsWidth[i[r]]-c;u=u>Math.abs(n)?n:-u,n+=Math.abs(u),e.colsWidth[d]+=u}r++}else if(n>0)e.colsWidth[i[0]]+=n}function E(e){var t=u(e);if(!(e.foot instanceof Array))t&&(t.style.display="none");else{if(!t)t=document.createElement("div"),t.id=o(e,"foot"),t.className=s(e,"foot"),n(t,"control-table",e.id),e.main.appendChild(t);if(t.style.display="",e.realWidth)t.style.width=e.realWidth+"px";t.innerHTML=T(e)}}function T(e){var t=[],n=e.foot,r=0,a=e.colsWidth,o=s(e,"fcell"),l=s(e,"fcell-text"),d=e.rowWidthOffset;t.push(Ve.format($e,{width:"100%",controlTableId:e.id}),"<tr>");for(var u=0,c=n.length;c>u;u++){var h=n[u],f=a[r],p=h.colspan||1,g=[o],v=h.content;if("function"==typeof v)v=v.call(e);if(i(v))v="&nbsp;";for(var m=1;p>m;m++)f+=a[r+m];if(r+=p,h.align)g.push(s(e,"cell-align-"+h.align));f+=d,0>f&&(f=0),t.push('<th id="'+V(e,u)+'" class="'+g.join(" ")+'"',' style="width:'+f+"px;",(f?"":"display:none;")+'">','<div class="'+l+'">',v,"</div></th>")}return t.push("</tr></table>"),t.join("")}function S(e){var t=l(e),i=o(e,"head-panel");if(!t)t=document.createElement("div"),t.id=o(e,"head"),t.className=s(e,"head"),n(t,"control-table",e.id),e.main.appendChild(t),t.innerHTML=Ve.format('<div id="${id}" data-ui="type:Panel;id:${id};"></div>',{id:i}),e.initChildren(t),e.headPanel=e.viewContext.get(i),Ne.addDOMEvent(e,t,"mousemove",Oe.bind(L,t,e)),Ne.addDOMEvent(e,t,"mousedown",Oe.bind(B,t,e));if(e.noHead)return void(t.style.display="none");if(t.style.display="",e.realWidth)t.style.width=e.realWidth+"px";Ve.g(i).innerHTML=D(e),M(e,e.viewContext.get(i))}function M(e,t){if(t.children)t.disposeChildren();if(e.hasTip)t.initChildren()}function D(e){var t=e.realFields,n=s(e,"hcell"),r=s(e,"hcell-text"),a=s(e,"cell-break"),l=s(e,"hsort"),d=s(e,"hcell-sel"),u=-1,c=-1,h=e.rowWidthOffset;if(!e.disabled){for(var f=0,p=t.length;p>f;f++)if(!t[f].stable){u=f;break}for(var f=p-1;f>=0;f--)if(!t[f].stable){c=f;break}}var g=[];g.push(Ve.format($e,{width:"100%",controlTableId:e.id}),"<tr>");for(var f=0,p=t.length;p>f;f++){var v=[n],m=t[f],y=m.title,x=e.sortable&&m.sortable,w=x&&m.field&&m.field==e.orderBy,b=r;if(0===f)b+=" "+s(e,"hcell-text-first");if(f===p-1)b+=" "+s(e,"hcell-text-last");var C="";if(x){if(v.push(s(e,"hcell-sort")),w)v.push(s(e,"hcell-"+e.order));C=Ve.format(Re,{className:l})}if(m.align)v.push(s(e,"cell-align-"+m.align));if(e.breakLine||m.breakLine)v.push(a);var P="",I="",E=m.tip;if("function"==typeof E)I=E.call(e);else I=E;if(I)P=Ve.format(Le,{id:o(e,"htip"+f),className:s(e,"htip"),content:I}),e.hasTip=!0;var T;if("function"==typeof y)T=y.call(e);else T=y;if(i(T))T="&nbsp;";g.push('<th id="'+k(e,f)+'"',' data-index="'+f+'"',' class="'+v.join(" ")+'"',x?' data-sortable="1"':"",f>=u&&c>f?' data-dragright="1"':"",c>=f&&f>u?' data-dragleft="1"':"",' style="',"width:"+(e.colsWidth[f]+h)+"px;",(e.colsWidth[f]?"":"display:none")+'">','<div class="'+b+(m.select?" "+d:"")+'">',P,T,C,"</div></th>")}return g.push("</tr></table>"),g.join("")}function k(e,t){return o(e,"title-cell")+t}function V(e,t){return o(e,"foot-cell")+t}function O(e,t){N(this,e)}function N(e,t){if(!e.isDraging&&!e.dragReady)if(Ne.addPartClasses(e,"hcell-hover",t),e.sortable){e.sortReady=1;var i=r(t,"index"),n=e.realFields[i];if(n&&n.sortable)Ne.addPartClasses(e,"hcell-sort-hover",t)}}function A(e,t){$(this,e)}function $(e,t){if(Ne.removePartClasses(e,"hcell-hover",t),e.sortable)e.sortReady=0,Ne.removePartClasses(e,"hcell-sort-hover",t)}function R(e,t){var i=this;if(i.sortable&&i.sortReady){var n=r(e,"index"),a=i.realFields[n];if(a.sortable){var o=i.orderBy,s=i.order;if(o==a.field)s=!s||"asc"==s?"desc":"asc";else s="desc";i.setProperties({order:s,orderBy:a.field}),i.fire("sort",{field:a,order:s})}}}function L(e,t){if(e.columnResizable){var i="startdrag",n=8;if(!e.isDraging){var a=t.target;if(a=H(e,a)){var o=this,s=t.pageX||t.clientX+Ve.page.getScrollLeft(),l=Ve.getOffset(a),d=r(a,"sortable");if(r(a,"dragleft")&&s-l.left<n)d&&$(e,a),Ne.addPartClasses(e,i,o),e.dragPoint="left",e.dragReady=1;else if(r(a,"dragright")&&l.left+a.offsetWidth-s<n)d&&$(e,a),Ne.addPartClasses(e,i,o),e.dragPoint="right",e.dragReady=1;else Ne.removePartClasses(e,i,o),d&&N(e,a),e.dragPoint="",e.dragReady=0}}}}function H(e,t){for(;1==t.nodeType;){if("TH"==t.nodeName)return t;t=t.parentNode}return null}function B(e,t){if(e.columnResizable){e.fire("startdrag"),e.fire("dragstart");var i=s(e,"startdrag"),n=t.target;if(n=H(e,n))if(!(Ve.g(o(e,"head")).className.indexOf(i)<0)){e.htmlHeight=document.documentElement.clientHeight,e.isDraging=!0,e.dragIndex=r(n,"index"),e.dragStart=t.pageX||t.clientX+Ve.page.getScrollLeft(),j(e);var a=Oe.partial(F,e),l=function(t){var i=!0;try{i=Oe.partial(Y,e)(t)}catch(n){}return Ve.un(document,"mousemove",a),Ve.un(document,"mouseup",l),i};return Ve.on(document,"mousemove",a),Ve.on(document,"mouseup",l),q(e,e.dragStart),Ve.event.preventDefault(t),!1}}}function j(e){var t=Ve.getOffset(e.main);e.top=t.top,e.left=t.left}function F(e,t){var i=t||window.event;return q(e,i.pageX||i.clientX+Ve.page.getScrollLeft()),Ve.event.preventDefault(i),!1}function q(e,t){var i=z(e),n=e.left+e.realWidth,r=e.left+1,a=n-1;if(t=r>t?r:t,t=t>a?a:t,!i)i=_(e);i.style.top=e.top+"px",i.style.left=t+"px",i.style.zIndex=e.zIndex||"";var o=e.htmlHeight-e.top+Ve.page.getScrollTop(),s=e.main.offsetHeight;o=s>o?o:s,i.style.height=o+"px"}function W(e){var t=z(e);t.style.left="-10000px",t.style.top="-10000px"}function _(e){var t=document.createElement("div");return t.id=o(e,"drag-mark"),t.className=s(e,"mark "),t.style.top="-10000px",t.style.left="-10000px",document.body.appendChild(t),t}function z(e){return Ve.g(o(e,"drag-mark"))}function Y(e,t){var i=t||window.event,n=parseInt(e.dragIndex,10),r=i.pageX||i.clientX+Ve.page.getScrollLeft(),a=e.realFields,o=a.length,s=0,l=e.colsWidth,d=0;if("left"==e.dragPoint)n--;var u=e.minColsWidth[n],c=r-e.dragStart,h=l[n]+c;if(u>h)c+=u-h,h=u;for(var f=[],p=[],g=n+1;o>g;g++)if(!a[g].stable&&l[g]>0)f.push(g),x=l[g],p.push(x),s+=x;for(var v=c,m=f.length,g=0;m>g;g++){var y=f[g],x=p[g],w=c*x/s,b=v>0?Math.ceil(w):Math.floor(w);if(b=Math.abs(b)<Math.abs(v)?b:v,x-=b,v-=b,u=e.minColsWidth[y],u>x)d+=u-x,x=u;l[y]=x}return h-=d,l[n]=h,de(e),e.isDraging=!1,W(e),e.fire("enddrag"),e.fire("dragend"),Ve.event.preventDefault(i),!1}function U(e){var t=d(e),i=o(e,"body-panel");if(!t){var n="body",r=o(e,n);t=document.createElement("div"),t.id=r,t.className=s(e,n),e.main.appendChild(t),t.innerHTML=Ve.format('<div id="${id}" data-ui="type:Panel;id:${id}"></div>',{id:i}),e.initChildren(t),e.bodyPanel=e.viewContext.get(i)}var a=t.style;if(a.overflowX="hidden",a.overflowY="auto",e.realWidth)a.width=e.realWidth+"px";e.bodyPanel.disposeChildren(),Ve.g(i).innerHTML=J(e),e.fire("bodyChange")}function X(e){var t=d(e),i=t.style,n=e.datasource.length,r=e.bodyMaxHeight;if(r>0&&n>0){var a=r,s=Ve.g(o(e,"body-panel"));if(s)a=s.offsetHeight;if(a>=r)return void(i.height=r+"px")}i.height="auto"}function J(e){var t=e.datasource||[],i=t.length,n=[];if(!i)return Ve.format(He,{className:s(e,"body-nodata"),html:e.noDataHtml});for(var r=e.rowBuilderList,a=0;i>a;a++){var o=t[a];n.push(K(e,o,a,r))}return n.join("")}function G(e,t,i){return o(e,"cell")+t+"-"+i}function Q(e,i){for(var n=e.rowBuilderList||[],r=0,a=i.length;a>r;r++){var o=i[r];if(o.getColHtml){if(o.getSubrowHtml)e.hasSubrow=!0;if(!t(o.index))o.index=1e3;n.push(o)}else;}n.sort(function(e,t){return e.index-t.index}),e.rowBuilderList=n}function Z(e){Q(e,[{index:1,getRowArgs:ee,getColHtml:te}])}function K(e,i,n,r){function a(e,t){return e.index-t.index}for(var s=[],l=e.realFields,d=e.rowWidthOffset,u=[],c=[],h=[],f=0,p=r.length;p>f;f++){var g=r[f],v=g.getRowArgs?g.getRowArgs(e,n)||{}:{};u.push(v),v.rowClass&&c.push(v.rowClass),v.rowAttr&&h.push(v.rowAttr)}for(var f=0,p=l.length;p>f;f++){for(var m=l[f],y=e.colsWidth[f],x=[],w=[],b=[],C=[],P=[],I=[],E=-1,T=0,S=r.length;S>T;T++){var M=r[T].getColHtml(e,i,m,n,f,u[T]);if(M){var D=M.html;if(M.colClass)x.push(M.colClass);if(M.textClass)w.push(M.textClass);if(M.colAttr)b.push(M.colAttr);if(M.textAttr)C.push(M.textAttr);if(t(D))if(M.notInText)M.index=T,I.push(M);else P.push(D),0>E&&(E=T)}else;}var k="";if(P=['<div class="'+w.join(" ")+'" ',C.join(" ")+">",P.join(""),"</div>"].join(""),I.push({html:P,index:E}),I.sort(a),I.length>1){for(var k=['<table width="100%" cellpadding="0" cellspacing="0">',"<tr>"],T=0,S=I.length;S>T;T++){var V=I[T];k.push("<td ",t(V.width)?' width="'+V.width+'" ':"",V.align?' align="'+V.align+'">':">",V.html,"</td>")}k.push("</tr></table>"),k=k.join("")}else k=P;s.push('<td id="'+G(e,n,f)+'" ','class="'+x.join(" ")+'" ',b.join(" ")+" ",'style="width:'+(y+d)+"px;",(y?"":"display:none")+'" ','data-control-table="'+e.id+'" ','data-row="'+n+'" data-col="'+f+'">',k,"</td>")}if(s.unshift(Ve.format(Be,{id:o(e,"row")+n,className:c.join(" "),attr:h.join(" "),index:n}),Ve.format($e,{width:"100%",controlTableId:e.id})),s.push("</tr></table></div>"),e.hasSubrow)for(var f=0,p=r.length;p>f;f++){var O=r[f].getSubrowHtml;if(O)s.push(O(e,n,u[f]))}return s.join("")}function ee(e,t){var i=e.datasource||[],n=i.length;return{tdCellClass:s(e,"cell"),tdBreakClass:s(e,"cell-break"),tdTextClass:s(e,"cell-text"),fieldLen:e.realFields.length,rowClass:[s(e,"row"),s(e,"row-"+(t%2?"odd":"even")),p(e,t)?s(e,"row-selected"):"",n-1==t?s(e,"row-last"):""].join(" ")}}function te(e,t,n,r,a,l){var d=l.tdCellClass,u=l.tdBreakClass,c=l.tdTextClass,h=[d],f=[c],p=n.content;if(0===a)f.push(s(e,"cell-text-first"));if(a===l.fieldLen-1)f.push(s(e,"cell-text-last"));if(e.breakLine||n.breakLine)h.push(u);if(n.select)f.push(s(e,"cell-sel"));if(n.align)h.push(s(e,"cell-align-"+n.align));if(n.field&&n.field==e.orderBy)h.push(s(e,"cell-sorted"));var g="function"==typeof p?p.call(e,t,r,a):e.encode?Ve.encodeHTML(t[p]):t[p];if(i(g))g="&nbsp;";return{colClass:h.join(" "),textClass:f.join(" "),html:Ve.format(je,{colTextId:o(e,"cell-textfield-"+r+"-"+a),content:g})}}function ie(e,t){if(!this.isDraging)Ne.addPartClasses(this,"row-hover",e)}function ne(e,t){Ne.removePartClasses(this,"row-hover",e)}function re(e,t){var i=this,n=Ne.getPartClasses(i,"cell-text")[0];if("line"==i.selectMode&&Ve.hasClass(t.target,n)){if(i.dontSelectLine)return void(i.dontSelectLine=!1);var a=r(e,"index");switch(i.select){case"multi":var s=Ve.g(o(i,"multi-select")+a);fe(i,a,!s.checked),pe(i);break;case"single":xe(i,a,!0)}}}function ae(e){e.viewWidth=Ve.page.getViewWidth(),e.viewHeight=Ve.page.getViewHeight();var t=function(){var t=Ve.page.getViewWidth(),i=Ve.page.getViewHeight();if(t!=e.viewWidth||i!=e.viewHeight)e.viewWidth=t,e.viewHeight=i,oe(e)};Ne.addDOMEvent(e,window,"resize",t)}function oe(e){var t=l(e),i=u(e);e.realWidth=g(e);var n=e.realWidth+"px";if(e.realWidth)e.main.style.width=n,d(e).style.width=n,t&&(t.style.width=n),i&&(i.style.width=n);if(I(e),de(e),e.followHead)b(e),w(e);j(e),e.fire("resize"),e.topReseter&&e.topReseter()}function se(e,t,i,n){if(e)e.style.top=i+"px",e.style.left=n+"px",e.style.position=t}function le(e){if(e.followHead&&!e.topReseter){var t=l(e),i=o(e,"top-placeholder"),n=document.createElement("div");n.id=i,n.style.width="100%",n.style.display="none",Ve.insertBefore(n,e.main),n=null,e.topReseter=function(){if(e.followHead){var n=Ve.page.getScrollTop(),r=Ve.ie&&Ve.ie<7?"absolute":"fixed",a=e.main.offsetHeight,o="absolute"==r,s=Ve.g(i),l=e.followDoms;if(e.noFollowHeadCache){var d=t.style.position;if("fixed"!==d&&"absolute"!==d)C(e)}if(n>e.followTop&&(o||n-e.followTop<a)){var u=Ve.page.getScrollLeft(),c=e.followHeightArr,h=c.length;j(e);var f=o?e.left:e.left-u;if(s.style.height=c[h-1]+t.offsetHeight+"px",s.style.display="",Ve.ie&&Ve.ie<8)t.style.zIndex=e.zIndex+1;if(o){for(var p=0,g=l.length;g>p;p++)se(l[p],r,c[p]+n,f);se(t,r,c[h-1]+n,f)}else{for(var p=0,g=l.length;g>p;p++)se(l[p],r,c[p],f);se(t,r,c[h-1],f)}}else{s.style.height=0,s.style.display="none",r="";for(var p=0,g=l.length;g>p;p++)se(l[p],r,0,0);se(t,r,0,0),t.style.zIndex=""}}},Ne.addDOMEvent(e,window,"scroll",e.topReseter)}}function de(e){var t=e.colsWidth,i=e.foot,n=e.id,a=i instanceof Array&&i.length,o=d(e).getElementsByTagName("td"),s=o.length,l=e.rowWidthOffset;if(a)for(var u=0,c=0;a>c;c++){for(var h=i[c],f=t[u],p=h.colspan||1,g=1;p>g;g++)f+=t[u+g];u+=p;var v=Ve.g(V(e,c));f=Math.max(f+l,0),v.style.width=f+"px",v.style.display=f?"":"none"}if(a=t.length,!e.noHead)for(var c=0;a>c;c++){var f=Math.max(t[c]+l,0),v=Ve.g(k(e,c));v.style.width=f+"px",v.style.display=f?"":"none"}for(var g=0,c=0;s>c;c++){var v=o[c];if(r(v,"control-table")==n){var f=Math.max(t[g%a]+l,0);v.style.width=f+"px",v.style.display=f?"":"none",g++}}}function ue(e){return{width:30,stable:!0,select:!0,title:function(t,i){var n={id:o(e,"select-all"),className:s(e,"select-all"),disabled:e.disabled?'disabled="disabled"':"",index:i};return Ve.format(Fe,n)},content:function(t,i){var n={id:o(e,"multi-select")+i,className:s(e,"multi-select"),disabled:e.disabled?'disabled="disabled"':"",index:i,checked:p(e,i)?'checked="checked"':""};return Ve.format(qe,n)}}}function ce(e){return{width:30,stable:!0,title:"&nbsp;",select:!0,content:function(t,i){var n=o(e,"single-select"),r={id:n+i,name:n,className:s(e,"single-select"),index:i,disabled:e.disabled?'disabled="disabled"':"",checked:p(e,i)?'checked="checked"':""};return Ve.format(We,r)}}}function he(e,t){var i=r(e,"index");fe(this,i),pe(this)}function fe(e,i,n){var a="row-selected";if(i>=0){var s=Ve.g(o(e,"multi-select")+i);if(s){t(n)&&(s.checked=n);var l=c(e,i);if(s.checked)Ne.addPartClasses(e,a,l);else Ne.removePartClasses(e,a,l)}}else if(t(n))for(var d=ve(e,"checkbox"),u=0,h=d.length;h>u;u++){var s=d[u];s.checked=n;var f=r(s,"index"),l=c(e,f);if(n)Ne.addPartClasses(e,a,l);else Ne.removePartClasses(e,a,l)}}function pe(e){for(var t=h(e),i=ve(e,"checkbox"),n=!0,a=[],s=o(e,"multi-select"),l=0,d=i.length;d>l;l++){var u=i[l];if(u.id.indexOf(s)>=0){var c=r(u,"index");if(!u.checked)n=!1;else a.push(c)}}f(e,a),e.fire("select",{selectedIndex:a}),t.checked=n}function ge(e){me(this,h(this).checked)}function ve(e,t){for(var i=d(e).getElementsByTagName("input"),n=[],r=0,a=i.length;a>r;r++){var o=i[r],s=o.id;if(o.getAttribute("type")==t&&s)n.push(o)}return n}function me(e,t){fe(e,-1,t),pe(e)}function ye(e,t){xe(this,r(e,"index"))}function xe(e,i,n){var r=e.selectedIndex,a=Ve.g(o(e,"single-select")+i);if(a){if(t(n)&&(a.checked=n),e.fire("select",{selectedIndex:i}),r&&r.length)Ne.removePartClasses(e,"row-selected",c(e,r[0]));f(e,[i]),Ne.addPartClasses(e,"row-selected",c(e,i))}}function we(e){e.main.style.zIndex=e.zIndex||""}function be(e){for(var t=ve(e,"multi"==e.select?"checkbox":"radio"),i=t.length-1;i>=0;i--)if(e.disabled)t[i].setAttribute("disabled","disabled");else t[i].removeAttribute("disabled");if("multi"==e.select){var n=h(e);if(n)if(e.disabled)n.setAttribute("disabled","disabled");else n.removeAttribute("disabled")}if(e.children&&e.children.length)for(var r=e.children,i=r.length-1;i>=0;i--)r[i].setDisabled(e.disabled)}function Ce(e){var t=" "+e+" ";return function(e){var i=" "+e.className+" ";return i.replace(_e," ").indexOf(t)>=0}}function Pe(e,t){var i=null;if(t)i="function"==typeof t?t:Ce(t);return{handler:e,matchFn:i}}function Ie(e,t,i){var n=t.id,r=e.handlers[n];if(!r)r=e.handlers[n]={};if(i)if(r=e.handlers[i],!r)r=e.handlers[i]=[];return r}function Ee(e,t,i,n){var r=Ie(e,t,i),a=[];if(!r.length)Me(e,t,i);for(var o=0,s=n.length;s>o;o++){var l=n[o],d=Pe(l.handler,l.matchFn);r.push(d),a.push(d)}return a}function Te(e,t,i,n){for(var r=Ie(e,t,i),a=0,o=n.length;o>a;a++)for(var s=n[a],l=0,d=r.length;d>l;l++)if(r[l]==s)r.splice(l,1),l--;if(!r.length)De(e,t,i)}function Se(e,t,i){return function(n){for(var n=n||window.event,r=n.target;r;){if(1===r.nodeType)for(var a=t.length-1;a>=0;a--){var o=t[a];if(!o.matchFn||o.matchFn(r))o.handler.call(i,r,n)}if(r==e)break;r=r.parentNode}}}function Me(e,t,i){var n=Ie(e,t,i);Ne.addDOMEvent(e,t,i,Se(t,n,e))}function De(e,t,i){Ne.removeDOMEvent(e,t,i)}function ke(e){var t=Ne.getPartClasses,i=t(e,"row")[0],n=t(e,"hcell")[0],r=t(e,"select-all")[0],a=t(e,"multi-select")[0],o=t(e,"single-select")[0];Ee(e,e.main,"mouseover",[{handler:ie,matchFn:i},{handler:O,matchFn:n}]),Ee(e,e.main,"mouseout",[{handler:ne,matchFn:i},{handler:A,matchFn:n}]),Ee(e,e.main,"click",[{handler:re,matchFn:i},{handler:R,matchFn:n},{handler:ge,matchFn:r},{handler:he,matchFn:a},{handler:ye,matchFn:o}])}var Ve=require("./lib"),Oe=require("underscore"),Ne=require("./controlHelper"),Ae=require("./Control");e.defaultProperties={noDataHtml:"没有数据",noFollowHeadCache:!1,followHead:!1,sortable:!1,encode:!1,columnResizable:!1,rowWidthOffset:-1,select:"",selectMode:"box",subrowMutex:1,subEntryOpenTip:"点击展开",subEntryCloseTip:"点击收起",subEntryWidth:18,breakLine:!1,hasTip:!1,hasSubrow:!1,tipWidth:18,sortWidth:9,fontSize:13,colPadding:8,zIndex:0};var $e='<table cellpadding="0" cellspacing="0" width="${width}" data-control-table="${controlTableId}">',Re='<div class="${className}"></div>',Le='<div id="${id}" class="${className}" data-ui="type:Tip;id:${id};content:${content}"></div>',He='<div class="${className}">${html}</div>',Be='<div id="${id}" class="${className}" data-index="${index}" ${attr}>',je='<span id="${colTextId}">${content}</span>',Fe='<input type="checkbox" id="${id}" class="${className}" data-index="${index}" ${disabled}/>',qe='<input type="checkbox" id="${id}" class="${className}" data-index="${index}" ${disabled} ${checked} />',We='<input type="radio" id="${id}" name="${name}" class="${className}" data-index="${index}" ${disabled} ${checked} />',_e=/[\t\r\n]/g;return e.prototype={type:"Table",initOptions:function(t){var i={};Oe.extend(i,e.defaultProperties,t),this.setProperties(i)},initStructure:function(){if(this.realWidth=g(this),this.realWidth)this.main.style.width=this.realWidth+"px";we(this),Z(this),ae(this),ke(this)},repaint:function(t,i){Ae.prototype.repaint.apply(this,arguments);var n=this;if(!n.realWidth)if(n.realWidth=g(n),n.realWidth)n.main.style.width=n.realWidth+"px";var r=e.defaultProperties,a={};if(!t){for(var o in r)if(r.hasOwnProperty(o))a[o]=!0}else for(var s=0;s<t.length;s++){var l=t[s];a[l.name]=!0}var d=!1,u=!1,c=!1;if(a.fields||a.select||a.selectMode||a.sortable)v(n),d=!0;if(d||a.breakLine||a.colPadding||a.fontSize)P(n),I(n),u=!0;if(d||u||a.noHead||a.order||a.orderBy||a.selectedIndex)S(n);if(a.followHead||a.noFollowHeadCache)m(n),le(n);if(d||u||a.encode||a.noDataHtml||a.datasource||a.selectedIndex)U(n),c=!0;if(c||a.bodyMaxHeight)X(n);if(d||u||a.foot)E(n);if(n.extraRepaint=Ne.createRepaint([{name:"disabled",paint:be},{name:"width",paint:oe},{name:"zIndex",paint:we}]),n.extraRepaint(t,i),c&&Ne.isInStage(n,"RENDERED"))switch(n.select){case"multi":f(n,[]),n.fire("select",{selectedIndex:n.selectedIndex})}if(n.realWidth!=g(n))oe(n)},getId:function(e){return o(this,e)},getBodyCellId:function(e,t){return G(this,e,t)},setCellText:function(e,t,n,r){if(r)e=Ve.encodeHTML(e);e=i(e)?"&nbsp":e,Ve.g(o(this,"cell-textfield-"+t+"-"+n)).innerHTML=e},getClass:function(e){return s(this,e)},getRow:function(e){return c(this,e)},addRowBuilders:function(e){Q(this,e)},addHandlers:function(e,t){if(!t.length)t=[t];return Ee(this,this.main,e,t)},removeHandlers:function(e,t){if(!t.length)t=[t];Te(this,this.main,e,t)},adjustWidth:function(){oe(this)},setDatasource:function(e){this.datasource=e,f(this,[]);var t={name:"datasource"},i={name:"selectedIndex"};this.repaint([t,i],{datasource:t,selectedIndex:i})},updateRowAt:function(e,t){t&&(this.datasource[e]=t);var i=this.datasource[e],n=c(this,e);if(i&&n){this.fire("beforerowupdate",{index:e,data:i});var r=document.createElement("div");r.innerHTML=K(this,t,e,this.rowBuilderList);var a=r.children[0];n.parentNode.replaceChild(a,n),this.fire("afterrowupdate",{index:e,data:i})}},getSelectedItems:function(){var e=this.selectedIndex,t=[];if(e){var i=this.datasource;if(i)for(var n=0;n<e.length;n++)t.push(i[e[n]])}return t},setRowSelected:function(e,t){var i=this,n="multi"===i.select,r=n?fe:xe;if(Oe.isArray(e))if(n)Oe.each(e,function(e){r(i,e,t)});else r(i,e[0],t);else r(i,e,t);if(n)pe(i)},setAllRowSelected:function(e){this.setRowSelected(-1,e)},resetFollowHead:function(){y(this)},dispose:function(){if(!Ne.isInStage(this,"DISPOSED")){Ne.beforeDispose(this);var e=this.main;if(e){this.followDoms=null;var t=Ve.g(o(this,"drag-mark"));if(t)document.body.removeChild(t)}this.rowBuilderList=null,this.headPanel.disposeChildren(),this.bodyPanel.disposeChildren(),this.headPanel=null,this.bodyPanel=null,Ne.dispose(this),Ne.afterDispose(this)}}},Ve.inherits(e,Ae),require("./main").register(e),e});