define(function(require){function e(e,t){for(var n=e,i=0;i<t.length;i++)n=n[t[i]];return n}function t(e,t,n,i){if("string"==typeof i)i=e[i];if("function"!=typeof i)return i;var o=e.get(t);if(o)o.on(n,i,e);return i}function n(){return"ef-"+r++}var i=require("underscore"),o=require("er/View");require("ef/ActionDialog");var exports={};exports.replaceValue=function(t){if("string"!=typeof t)return t;if("@@"===t||"**"===t)return this.model;var n=t.charAt(0),i=t.substring(1);if("@"===n||"*"===n){var o=i.split("."),t=this.model.get(o[0]);return o.length>1?e(t,o.slice(1)):t}else return t},exports.get=function(e){return this.viewContext.get(e)},exports.getSafely=function(e){return this.viewContext.getSafely(e)},exports.getGroup=function(e){return this.viewContext.getGroup(e)},exports.create=function(e,t){if(t=t||{},!t.viewContext)t.viewContext=this.viewContext;return require("esui").create(e,t)},exports.alert=function(e,t){var n="string"==typeof e?{title:t||document.title,content:e}:i.clone(e);if(!n.viewContext)n.viewContext=this.viewContext;var o=require("esui/Dialog");return o.alert(n)},exports.confirm=function(e,t){var n="string"==typeof e?{title:t||document.title,content:e}:i.clone(e);if(!n.viewContext)n.viewContext=this.viewContext;var o=require("esui/Dialog");return o.confirm(n)},exports.popActionDialog=function(e){var t=document.createElement("div");document.body.appendChild(t);var n={width:600,needFoot:!1,draggable:!0,closeOnHide:!0,autoClose:!0,main:t,viewContext:this.viewContext};e=i.defaults({},e,n);var o=require("esui/main"),r=o.create("ActionDialog",e);return r.render(),r.show(),r},exports.uiEvents=null,exports.getUIEvents=function(){return this.uiEvents||{}},exports.uiProperties=null,exports.getUIProperties=function(){return this.uiProperties},exports.bindEvents=function(){var e=this.getUIEvents();if(e)for(var n in e)if(e.hasOwnProperty(n)){var i=n.split(":");if(i.length>1){var o=i[0],r=i[1],a=e[n];t(this,o,r,a)}else{var s=e[n];if("object"!=typeof s)return;for(var r in s)if(s.hasOwnProperty(r)){var a=s[r];t(this,n,r,a)}}}else;};var r=8785925;exports.getViewName=function(){if(this.name)return this.name;var e=this.constructor&&this.constructor.name;if(!e&&this.constructor){var t=this.constructor.toString(),i=/function\s+([^\(]*)/.exec(t);e=i&&i[1].replace(/\s+$/g,"")}if(!e)e=n();if(e=e.replace(/View$/,""),e=e.replace(/[A-Z]{2,}/g,function(e){return e.charAt(0)+e.slice(1,-1).toLowerCase()+e.charAt(e.length-1)}),e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),"-"===e.charAt(0))e=e.substring(1);return e},exports.createViewContext=function(){var e=require("esui/ViewContext"),t=this.getViewName();return new e(t||null)},exports.enterDocument=function(){this.viewContext=this.createViewContext();var e=this.getContainerElement(),t={viewContext:this.viewContext,properties:this.getUIProperties(),valueReplacer:i.bind(this.replaceValue,this)};try{require("esui").init(e,t)}catch(n){var o=new Error("ESUI initialization error on view because: "+n.message);throw o.actualError=n,o}this.bindEvents()},exports.dispose=function(){if(this.viewContext)this.viewContext.dispose(),this.viewContext=null;this.$super(arguments)};var a=require("eoo").create(o,exports);return a});