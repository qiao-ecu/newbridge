define(function(require){function e(){return"WINDOWFOCUS"===i}function t(e,t,n){if(0===e.from)return!1;if(t)if(r.contains(n,e.bid))return!1;return!0}function n(e){var t=(e.bid,{data:{}}),n=document.createElement("div");return n.innerHTML=e.content,t.data.body=a.getText(n),t.title=e.name,delete n,t.click=function(){exports.select({id:e.bid,visitorType:"visiting"})},t}var i,exports={},r=require("underscore"),a=require("im-lib").util,o=requireNode("client-vm")(),s=requireNode("nw.gui"),l=(s.Window.get(),require("common/message/messageFactory")),u=require("eff"),d=(u.Either.Left,u.Either.Right),c=(u.Monad.mApply,u.Monad.flow);return exports.showMsgNotify=function(i){if(e())o.data("vm:visitor","rooms","front").then(function(e){r.map(i.value,function(i){if(t(i,!0,e))d(i).mApply(l.checkWhiteList).mApply(function(e){return exports.notify(n(e)),d()})})});else r.map(i.value,function(e){if(t(e))c(d(e),l.checkWhiteList,function(e){return exports.notify(n(e)),d()})})},exports.setWinStatus=function(e){i=e},exports.notify=function(){},exports.select=function(){},exports});