define(function(require){function e(){s.on("focus",function(){u=l.FOCUS,exports.sendWinStatus(u)}),s.on("blur",function(){u=l.BLUR,exports.sendWinStatus(u)})}function t(e){var t=e.name+","+e.subViewName+","+e.dynamicViewName+","+e.type;switch(a[t]){case"NEWMESSAGE":exports.addMessage(e,u===l.FOCUS);break;case"NEWVISTOR":exports.addVistor(e);break;case"CHANGEUSERTATUS":exports.changeUserStatus(e.value[0].status)}}function n(){var e=document.createElement("AUDIO");e.setAttribute("src","../../resource/msg.wav"),e.id="msgAudio",e.innerHTML="",document.body.appendChild(e)}var exports={},i=require("underscore"),r=requireNode("client-vm")(),a={"vm:visitor,notify,notify,insert":"NEWVISTOR","vm:chatroom,talking,talking,insert":"NEWMESSAGE","vm:user,info,info,update":"CHANGEUSERTATUS"},o=requireNode("nw.gui"),s=o.Window.get(),l={SHOW:"WINDOWSHOW",HIDE:"WINDOWHIDE",FOCUS:"WINDOWFOCUS",BLUR:"WINDOWBLUR"},u="WINDOWFOCUS",d=require("./notification");return exports.init=function(){r.on("data",t),n(),e(),exports.sendWinStatus(u)},exports.sendWinStatus=function(e){},exports.addMessage=function(){},exports.addVistor=function(e){i.map(e.value,function(e){d.addNotify({title:"新访客",data:{body:e.name}})})},exports.changeUserStatus=function(){},exports});