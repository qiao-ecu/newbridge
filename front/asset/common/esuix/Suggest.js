define(function(require){function e(e){for(var t=o.event.getTarget(e),n=this.layer.getElement();t&&t!==n&&!o.hasAttribute(t,"data-index");)t=t.parentNode;if(t&&!this.helper.isPart(t,"item-disabled")){var i=t.getAttribute("data-index");if(this.setValue(this.datasource[+i].value),"clickToSelect"===this.mode){var r=this.helper.getPart("input");r.value=this.datasource[+i].text,this.layer.hide()}this.fire("search")}}function t(){r.apply(this,arguments)}function n(){s.apply(this,arguments),this.layer=new t(this)}var i=require("underscore"),r=require("esui/Layer"),a=require("esui/main"),o=require("esui/lib"),s=require("esui/InputControl");o.inherits(t,r),t.prototype.nodeName="div",t.prototype.render=function(e){var t="",n=this.control.datasource||[];if(!n.length)n.push({text:this.control.noDataText||"暂无数据",disabled:!0});t+='<div class="suggest-layer-content"><ol>';for(var i=0;i<n.length;i++){var r=n[i],a=this.control.helper.getPartClasses("item");if(r.disabled)a.push.apply(a,this.control.helper.getPartClasses("item-disabled"));t+='<li data-index="'+i+'" class="'+a.join(" ")+'">',t+=r.text,t+="</li>"}t+="</ol></div>",e.innerHTML=t},t.prototype.initBehavior=function(t){this.control.helper.addDOMEvent(t,"click",e)},t.prototype.dock={strictWidth:!0},n.prototype.type="Suggest",n.prototype.mode="clickToSelect",n.prototype.initStructure=function(){var e=this.helper.getPartClasses("input"),t=this.helper.getPartClasses("icon"),n=this.helper.getId("input"),i=this.helper.getId("icon"),r='<div id="'+i+'" class="'+t.join(" ")+'"></div>';r+='<input id="'+n+'" class="'+e.join(" ")+'" value="'+(this.searchText||"")+'" tabindex="-1">',this.main.innerHTML=r},n.prototype.initEvents=function(){var e=this,t=this.helper.getPart("input"),n=this.helper.getPart("icon");this.helper.addDOMEvent(n,"click",function(){e.fire("search")});var i=0,r=null;this.helper.addDOMEvent(t,"keyup",function(n){if(13===n.keyCode)return void e.fire("search");else return e.setValue(null),clearTimeout(r),void(r=setTimeout(function(){var n=1*new Date;i=n,e.handleChange=e.handleChange||function(){};var r=t.value;e.handleChange(r,function(t){if(!(i>n))e.datasource=t,e.repaint(),e.layer.show()})},this.timeout||300))})},n.prototype.getText=function(){var e=this.helper.getPart("input");return e.value},n.prototype.handleChange=function(e,t){var n=[{text:1,value:1},{text:2,value:2}],r=parseInt(e,10),a=i.filter(n,function(e){return r>e.value});t(a)};var l=require("esui/painters");return n.prototype.repaint=l.createRepaint(s.prototype.repaint,l.style("width"),l.style("height"),{name:"width",paint:function(e,t){var n=e.helper.getPart("input");n.style.width=t-38+"px"}},{name:"datasource",paint:function(e){e.layer.repaint()}},{name:"placeholder",paint:function(e,t){var n=e.helper.getPart("input");n.placeholder=t}},{name:["disabled","hidden","readOnly"],paint:function(e,t,n,i){if(t||n||i)e.layer.hide()}}),n.prototype.dispose=function(){if(!this.helper.isInStage("DISPOSED")){if(this.layer)this.layer.dispose(),this.layer=null;s.prototype.dispose.apply(this,arguments)}},o.inherits(n,s),a.register(n),n});