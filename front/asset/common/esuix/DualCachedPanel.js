define(function(require){function e(){t.apply(this,arguments)}var t=require("esui/Control"),n=require("esui/Panel"),i=require("esui/lib"),r=require("er/Deferred");return require("./ActionPanelX"),e.prototype.type="DualCachedPanel",e.prototype.initStructure=function(){this.main.innerHTML='<div data-ui="type:ActionPanelX;childName:panel1;skin:dualcachedpanel"></div><div data-ui="type:ActionPanelX;childName:panel2;skin:dualcachedpanel"></div>',this.initChildren(this.main),this.currentPanel="panel1";var e=this.getCurrentPanel(),t=this.getBackgroundPanel();this.helper.addPartClasses("foreground",e.main),this.helper.addPartClasses("background",t.main)},e.prototype.delegateActionEvent=function(e){var t=require("mini-event").fromEvent(e,{preserveData:!0,syncState:!0});t.type=e.type,this.fire(t)},e.prototype.initEvents=function(){var e=this,t=this.getCurrentPanel(),n=this.getBackgroundPanel();t.on("*",this.delegateActionEvent,this);var i=new r;this.promise=i.promise,t.on("actionloaded",function(){e.fire("ready"),i.resolve()}),t.on("actionloadfail",function(e){i.reject(e.reason)}),t.on("actionloadabort",function(){i.reject("actionloadabort")}),n.on("actionloaded",function(){e.fire("ready"),i.resolve()}),n.on("actionloadfail",function(e){i.reject(e.reason)}),n.on("actionloadabort",function(){i.reject("actionloadabort")})},e.prototype.getCurrentPanel=function(){return this.getChild(this.currentPanel)},e.prototype.switchPanel=function(){var e=this,t=this.getCurrentPanel(),n=this.getBackgroundPanel();if(t.un("*",this.delegateActionEvent,this),n.on("*",this.delegateActionEvent,this),this.helper.addPartClasses("background",t.main),this.helper.removePartClasses("foreground",t.main),this.helper.addPartClasses("foreground",n.main),this.helper.removePartClasses("background",n.main),"panel1"===this.currentPanel?this.currentPanel="panel2":this.currentPanel="panel1",this.fire("ready"),this.on("action@dualcachedpanelredirect",function(t){e.set("url",t.data)}),this.on("action@redirect",function(t){e.set("url",t.data)}),n.action)n.action.fire("switched")},e.prototype.getBackgroundPanel=function(){if("panel1"===this.currentPanel)return this.getChild("panel2");else return this.getChild("panel1")},e.prototype.repaint=require("esui/painters").createRepaint(n.prototype.repaint,{name:["url","actionOptions"],paint:function(e,t,n){if(t){var i=e.getCurrentPanel(),r=e.getBackgroundPanel();if(i.action)i.action.fire("switchtobackground");if(r.disposeAction(),!r.lazy||!r.helper.isInStage("INITED")){r.once("ready",e.switchPanel,e);var a=require("er/controller");if(r.action=a.renderChildAction(t,r.main.id,n),"function"!=typeof r.action.abort)r.action=null}}}}),i.inherits(e,t),require("esui/main").register(e),e});