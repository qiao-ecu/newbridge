define(function(require){function e(e){var t={followHeightArr:[0,0],followWidthArr:[],handlers:[]};Ne.call(this,Ee.extend({},e,t))}function t(e){return!("undefined"==typeof e||null===e)}function n(e){return!t(e)||!e.toString().length}function i(e,t,n){Pe.setAttribute(e,"data-"+t,n)}function r(e,t){return Pe.getAttribute(e,"data-"+t)}function a(e,t){var n=Pe.getStyle(e,t);return""===n?0:parseInt(n,10)||0}function o(e,t){return Ie.getId(e,t)}function s(e,t){return Ie.getPartClasses(e,t).join(" ")}function l(e){return Pe.g(o(e,"head"))}function u(e){return Pe.g(o(e,"body"))}function d(e){return Pe.g(o(e,"foot"))}function c(e,t){return Pe.g(o(e,"row")+t)}function f(e){return Pe.g(o(e,"select-all"))}function h(e,t){e.selectedIndex=t;for(var n={},i=t.length-1;i>=0;i--)n[t[i]]=1;e.selectedIndexMap=n}function p(e,t){if(e.selectedIndexMap)return!!e.selectedIndexMap[t];else return!1}function m(e){if(e.width)return e.width;var t=document.createElement("div"),n=e.main.parentNode;n.appendChild(t);var i=t.offsetWidth;return t.parentNode.removeChild(t),i}function g(e){if(e.fields){for(var t=e.fields,n=t.slice(0),i=n.length;i--;)if(!n[i])n.splice(i,1);if(e.realFields=n,e.select)switch(e.select.toLowerCase()){case"multi":n.unshift(de(e));break;case"single":n.unshift(ce(e))}}}function v(e){if(e.followHead)if(_(e),!e.noFollowHeadCache)x(e)}function y(e){if(e.followHead)_(e),x(e)}function _(e){if(e.followHead){for(var t=e.followDoms=[],n=e.main.parentNode.firstChild,i=e.id;n;){if(1===n.nodeType&&r(n,"follow-thead")===i)t.push(n);n=n.nextSibling}w(e),b(e)}}function b(e){var t=e.followDoms,n=e.followHeightArr;n[0]=0;for(var i=0,r=t.length;r>i;i++){var a=t[i];n[i+1]=n[i]+a.offsetHeight}n[i+1]=n[i],n.lenght=i+2}function w(e){for(var t=e.followDoms,n=e.followWidthArr,i=0,r=t.length;r>i;i++){var o=t[i],s=a(o,"padding-left")+a(o,"padding-right")+a(o,"border-left-width")+a(o,"border-right-width");n[i]=s,t[i].style.width=e.realWidth-s+"px"}}function x(e){var t=e.followDoms,n=Pe.getOffset(t[0]||e.main);e.followTop=n.top,e.followLeft=n.left}function M(e){var t=e.realFields,n=[],i=e.fontSize,r=2*e.colPadding+5;if(!e.noHead)for(var a=0,o=t.length;o>a;a++){var s=t[a],l=s.minWidth;if(!l&&!s.breakLine)l=s.title.length*i+r+(e.sortable&&s.sortable?e.sortWidth:0)+(s.tip?e.tipWidth:0);n[a]=l}else for(var u=i+r,a=0,o=t.length;o>a;a++)n[a]=u;e.minColsWidth=n}function L(e){var t=e.realFields,n=[];e.colsWidth=[];for(var i=e.realWidth-1,r=0,a=t.length;a>r;r++){var o=t[r],s=o.width;if(s=s?parseInt(s,10):0,e.colsWidth.push(s),i-=s,!o.stable)n.push(r)}for(var a=n.length,l=Math.round(i/a),r=0;a>r;r++){var u=n[r],d=Math.abs(i)<Math.abs(l)?i:l;i-=d,e.colsWidth[u]+=d;var c=e.minColsWidth[u];if(c>e.colsWidth[u])i+=e.colsWidth[u]-c,e.colsWidth[u]=c}if(0>i)for(var r=0;a>r&&0!==i;){var u=n[r],c=e.minColsWidth[u];if(c<e.colsWidth[u]){var d=e.colsWidth[n[r]]-c;d=d>Math.abs(i)?i:-d,i+=Math.abs(d),e.colsWidth[u]+=d}r++}else if(i>0)e.colsWidth[n[0]]+=i}function T(e){var t=d(e);if(!(e.foot instanceof Array))t&&(t.style.display="none");else{if(!t)t=document.createElement("div"),t.id=o(e,"foot"),t.className=s(e,"foot"),i(t,"control-table",e.id),e.main.appendChild(t);if(t.style.display="",e.realWidth)t.style.width=e.realWidth+"px";t.innerHTML=C(e)}}function C(e){var t=[],i=e.foot,r=0,a=e.colsWidth,o=s(e,"fcell"),l=s(e,"fcell-text"),u=e.rowWidthOffset;t.push(Pe.format(je,{width:"100%",controlTableId:e.id}),"<tr>");for(var d=0,c=i.length;c>d;d++){var f=i[d],h=a[r],p=f.colspan||1,m=[o],g=f.content;if("function"==typeof g)g=g.call(e);if(n(g))g="&nbsp;";for(var v=1;p>v;v++)h+=a[r+v];if(r+=p,f.align)m.push(s(e,"cell-align-"+f.align));h+=u,0>h&&(h=0),t.push('<th id="'+P(e,d)+'" class="'+m.join(" ")+'"',' style="width:'+h+"px;",(h?"":"display:none;")+'">','<div class="'+l+'">',g,"</div></th>")}return t.push("</tr></table>"),t.join("")}function D(e){var t=l(e),n=o(e,"head-panel");if(!t)t=document.createElement("div"),t.id=o(e,"head"),t.className=s(e,"head"),i(t,"control-table",e.id),e.main.appendChild(t),t.innerHTML=Pe.format('<div id="${id}" data-ui="type:Panel;id:${id};"></div>',{id:n}),e.initChildren(t),e.headPanel=e.viewContext.get(n),Ie.addDOMEvent(e,t,"mousemove",Ee.bind(A,t,e)),Ie.addDOMEvent(e,t,"mousedown",Ee.bind(R,t,e));if(e.noHead)return void(t.style.display="none");if(t.style.display="",e.realWidth)t.style.width=e.realWidth+"px";Pe.g(n).innerHTML=Y(e),k(e,e.viewContext.get(n))}function k(e,t){if(t.children)t.disposeChildren();if(e.hasTip)t.initChildren()}function Y(e){var t=e.realFields,i=s(e,"hcell"),r=s(e,"hcell-text"),a=s(e,"cell-break"),l=s(e,"hsort"),u=s(e,"hcell-sel"),d=-1,c=-1,f=e.rowWidthOffset;if(!e.disabled){for(var h=0,p=t.length;p>h;h++)if(!t[h].stable){d=h;break}for(var h=p-1;h>=0;h--)if(!t[h].stable){c=h;break}}var m=[];m.push(Pe.format(je,{width:"100%",controlTableId:e.id}),"<tr>");for(var h=0,p=t.length;p>h;h++){var g=[i],v=t[h],y=v.title,_=e.sortable&&v.sortable,b=_&&v.field&&v.field==e.orderBy,w=r;if(0===h)w+=" "+s(e,"hcell-text-first");if(h===p-1)w+=" "+s(e,"hcell-text-last");var x="";if(_){if(g.push(s(e,"hcell-sort")),b)g.push(s(e,"hcell-"+e.order));x=Pe.format(Oe,{className:l})}if(v.align)g.push(s(e,"cell-align-"+v.align));if(e.breakLine||v.breakLine)g.push(a);var M="",L="",T=v.tip;if("function"==typeof T)L=T.call(e);else L=T;if(L)M=Pe.format(Ae,{id:o(e,"htip"+h),className:s(e,"htip"),content:L}),e.hasTip=!0;var C;if("function"==typeof y)C=y.call(e);else C=y;if(n(C))C="&nbsp;";m.push('<th id="'+S(e,h)+'"',' data-index="'+h+'"',' class="'+g.join(" ")+'"',_?' data-sortable="1"':"",h>=d&&c>h?' data-dragright="1"':"",c>=h&&h>d?' data-dragleft="1"':"",' style="',"width:"+(e.colsWidth[h]+f)+"px;",(e.colsWidth[h]?"":"display:none")+'">','<div class="'+w+(v.select?" "+u:"")+'">',M,C,x,"</div></th>")}return m.push("</tr></table>"),m.join("")}function S(e,t){return o(e,"title-cell")+t}function P(e,t){return o(e,"foot-cell")+t}function E(e,t){I(this,e)}function I(e,t){if(!e.isDraging&&!e.dragReady)if(Ie.addPartClasses(e,"hcell-hover",t),e.sortable){e.sortReady=1;var n=r(t,"index"),i=e.realFields[n];if(i&&i.sortable)Ie.addPartClasses(e,"hcell-sort-hover",t)}}function N(e,t){j(this,e)}function j(e,t){if(Ie.removePartClasses(e,"hcell-hover",t),e.sortable)e.sortReady=0,Ie.removePartClasses(e,"hcell-sort-hover",t)}function O(e,t){var n=this;if(n.sortable&&n.sortReady){var i=r(e,"index"),a=n.realFields[i];if(a.sortable){var o=n.orderBy,s=n.order;if(o==a.field)s=!s||"asc"==s?"desc":"asc";else s="desc";n.setProperties({order:s,orderBy:a.field}),n.fire("sort",{field:a,order:s})}}}function A(e,t){if(e.columnResizable){var n="startdrag",i=8;if(!e.isDraging){var a=t.target;if(a=H(e,a)){var o=this,s=t.pageX||t.clientX+Pe.page.getScrollLeft(),l=Pe.getOffset(a),u=r(a,"sortable");if(r(a,"dragleft")&&s-l.left<i)u&&j(e,a),Ie.addPartClasses(e,n,o),e.dragPoint="left",e.dragReady=1;else if(r(a,"dragright")&&l.left+a.offsetWidth-s<i)u&&j(e,a),Ie.addPartClasses(e,n,o),e.dragPoint="right",e.dragReady=1;else Ie.removePartClasses(e,n,o),u&&I(e,a),e.dragPoint="",e.dragReady=0}}}}function H(e,t){for(;1==t.nodeType;){if("TH"==t.nodeName)return t;t=t.parentNode}return null}function R(e,t){if(e.columnResizable){e.fire("startdrag"),e.fire("dragstart");var n=s(e,"startdrag"),i=t.target;if(i=H(e,i))if(!(Pe.g(o(e,"head")).className.indexOf(n)<0)){e.htmlHeight=document.documentElement.clientHeight,e.isDraging=!0,e.dragIndex=r(i,"index"),e.dragStart=t.pageX||t.clientX+Pe.page.getScrollLeft(),V(e);var a=Ee.partial(W,e),l=function(t){var n=!0;try{n=Ee.partial(z,e)(t)}catch(i){}return Pe.un(document,"mousemove",a),Pe.un(document,"mouseup",l),n};return Pe.on(document,"mousemove",a),Pe.on(document,"mouseup",l),F(e,e.dragStart),Pe.event.preventDefault(t),!1}}}function V(e){var t=Pe.getOffset(e.main);e.top=t.top,e.left=t.left}function W(e,t){var n=t||window.event;return F(e,n.pageX||n.clientX+Pe.page.getScrollLeft()),Pe.event.preventDefault(n),!1}function F(e,t){var n=q(e),i=e.left+e.realWidth,r=e.left+1,a=i-1;if(t=r>t?r:t,t=t>a?a:t,!n)n=B(e);n.style.top=e.top+"px",n.style.left=t+"px",n.style.zIndex=e.zIndex||"";var o=e.htmlHeight-e.top+Pe.page.getScrollTop(),s=e.main.offsetHeight;o=s>o?o:s,n.style.height=o+"px"}function $(e){var t=q(e);t.style.left="-10000px",t.style.top="-10000px"}function B(e){var t=document.createElement("div");return t.id=o(e,"drag-mark"),t.className=s(e,"mark "),t.style.top="-10000px",t.style.left="-10000px",document.body.appendChild(t),t}function q(e){return Pe.g(o(e,"drag-mark"))}function z(e,t){var n=t||window.event,i=parseInt(e.dragIndex,10),r=n.pageX||n.clientX+Pe.page.getScrollLeft(),a=e.realFields,o=a.length,s=0,l=e.colsWidth,u=0;if("left"==e.dragPoint)i--;var d=e.minColsWidth[i],c=r-e.dragStart,f=l[i]+c;if(d>f)c+=d-f,f=d;e.realWidth+=+c;for(var h=[],p=[],m=i+1;o>m;m++)if(!a[m].stable&&l[m]>0)h.push(m),_=l[m],p.push(_),s+=_;for(var g=c,v=h.length,m=0;v>m;m++){var y=h[m],_=p[m],b=c*_/s,w=g>0?Math.ceil(b):Math.floor(b);if(w=Math.abs(w)<Math.abs(g)?w:g,g-=w,d=e.minColsWidth[y],d>_)u+=d-_,_=d;l[y]=_}return f-=u,l[i]=f,oe(e,!0),e.isDraging=!1,$(e),e.fire("enddrag"),e.fire("dragend"),Pe.event.preventDefault(n),!1}function U(e){var t=u(e),n=o(e,"body-panel");if(!t){var i="body",r=o(e,i);t=document.createElement("div"),t.id=r,t.className=s(e,i),e.main.appendChild(t),t.innerHTML=Pe.format('<div id="${id}" data-ui="type:Panel;id:${id}"></div>',{id:n}),e.initChildren(t),e.bodyPanel=e.viewContext.get(n)}var a=t.style;if(a.overflowX="hidden",a.overflowY="auto",e.realWidth)a.width=e.realWidth+"px";e.bodyPanel.disposeChildren(),Pe.g(n).innerHTML=X(e),e.fire("bodyChange")}function G(e){var t=u(e),n=t.style,i=e.datasource.length,r=e.bodyMaxHeight;if(r>0&&i>0){var a=r,s=Pe.g(o(e,"body-panel"));if(s)a=s.offsetHeight;if(a>=r)return void(n.height=r+"px")}n.height="auto"}function X(e){var t=e.datasource||[],n=t.length,i=[];if(!n)return Pe.format(He,{className:s(e,"body-nodata"),html:e.noDataHtml});for(var r=e.rowBuilderList,a=0;n>a;a++){var o=t[a];i.push(Q(e,o,a,r))}return i.join("")}function J(e,t,n){return o(e,"cell")+t+"-"+n}function Z(e,n){for(var i=e.rowBuilderList||[],r=0,a=n.length;a>r;r++){var o=n[r];if(o.getColHtml){if(o.getSubrowHtml)e.hasSubrow=!0;if(!t(o.index))o.index=1e3;i.push(o)}else;}i.sort(function(e,t){return e.index-t.index}),e.rowBuilderList=i}function K(e){Z(e,[{index:1,getRowArgs:ee,getColHtml:te}])}function Q(e,n,i,r){function a(e,t){return e.index-t.index}for(var s=[],l=e.realFields,u=e.rowWidthOffset,d=[],c=[],f=[],h=0,p=r.length;p>h;h++){var m=r[h],g=m.getRowArgs?m.getRowArgs(e,i)||{}:{};d.push(g),g.rowClass&&c.push(g.rowClass),g.rowAttr&&f.push(g.rowAttr)}for(var h=0,p=l.length;p>h;h++){for(var v=l[h],y=e.colsWidth[h],_=[],b=[],w=[],x=[],M=[],L=[],T=-1,C=0,D=r.length;D>C;C++){var k=r[C].getColHtml(e,n,v,i,h,d[C]);if(k){var Y=k.html;if(k.colClass)_.push(k.colClass);if(k.textClass)b.push(k.textClass);if(k.colAttr)w.push(k.colAttr);if(k.textAttr)x.push(k.textAttr);if(t(Y))if(k.notInText)k.index=C,L.push(k);else M.push(Y),0>T&&(T=C)}else;}var S="";if(M=['<div class="'+b.join(" ")+'" ',x.join(" ")+">",M.join(""),"</div>"].join(""),L.push({html:M,index:T}),L.sort(a),L.length>1){for(var S=['<table width="100%" cellpadding="0" cellspacing="0">',"<tr>"],C=0,D=L.length;D>C;C++){var P=L[C];S.push("<td ",t(P.width)?' width="'+P.width+'" ':"",P.align?' align="'+P.align+'">':">",P.html,"</td>")}S.push("</tr></table>"),S=S.join("")}else S=M;s.push('<td id="'+J(e,i,h)+'" ','class="'+_.join(" ")+'" ',w.join(" ")+" ",'style="width:'+(y+u)+"px;",(y?"":"display:none")+'" ','data-control-table="'+e.id+'" ','data-row="'+i+'" data-col="'+h+'">',S,"</td>")}if(s.unshift(Pe.format(Re,{id:o(e,"row")+i,className:c.join(" "),attr:f.join(" "),index:i}),Pe.format(je,{width:"100%",controlTableId:e.id})),s.push("</tr></table></div>"),e.hasSubrow)for(var h=0,p=r.length;p>h;h++){var E=r[h].getSubrowHtml;if(E)s.push(E(e,i,d[h]))}return s.join("")}function ee(e,t){var n=e.datasource||[],i=n.length;return{tdCellClass:s(e,"cell"),tdBreakClass:s(e,"cell-break"),tdTextClass:s(e,"cell-text"),fieldLen:e.realFields.length,rowClass:[s(e,"row"),s(e,"row-"+(t%2?"odd":"even")),p(e,t)?s(e,"row-selected"):"",i-1==t?s(e,"row-last"):""].join(" ")}}function te(e,t,i,r,a,l){var u=l.tdCellClass,d=l.tdBreakClass,c=l.tdTextClass,f=[u],h=[c],p=i.content;if(0===a)h.push(s(e,"cell-text-first"));if(a===l.fieldLen-1)h.push(s(e,"cell-text-last"));if(e.breakLine||i.breakLine)f.push(d);if(i.select)h.push(s(e,"cell-sel"));if(i.align)f.push(s(e,"cell-align-"+i.align));if(i.field&&i.field==e.orderBy)f.push(s(e,"cell-sorted"));var m="function"==typeof p?p.call(e,t,r,a):e.encode?Pe.encodeHTML(t[p]):t[p];if(n(m))m="&nbsp;";return{colClass:f.join(" "),textClass:h.join(" "),html:Pe.format(Ve,{colTextId:o(e,"cell-textfield-"+r+"-"+a),content:m})}}function ne(e,t){if(!this.isDraging)Ie.addPartClasses(this,"row-hover",e)}function ie(e,t){Ie.removePartClasses(this,"row-hover",e)}function re(e,t){var n=this,i=Ie.getPartClasses(n,"cell-text")[0];if("line"==n.selectMode&&Pe.hasClass(t.target,i)){if(n.dontSelectLine)return void(n.dontSelectLine=!1);var a=r(e,"index");switch(n.select){case"multi":var s=Pe.g(o(n,"multi-select")+a);he(n,a,!s.checked),pe(n);break;case"single":_e(n,a,!0)}}}function ae(e){e.viewWidth=Pe.page.getViewWidth(),e.viewHeight=Pe.page.getViewHeight();var t=function(){var t=Pe.page.getViewWidth(),n=Pe.page.getViewHeight();if(t!=e.viewWidth||n!=e.viewHeight)e.viewWidth=t,e.viewHeight=n,oe(e)};Ie.addDOMEvent(e,window,"resize",t)}function oe(e,t){var n=l(e),i=d(e),r=m(e);e.previousContainerWidth;if(e.realWidth<r)e.realWidth=r;var a=e.realWidth+"px";if(e.realWidth)e.main.style.width=a,u(e).style.width=a,n&&(n.style.width=a),i&&(i.style.width=a);if(!t)L(e);if(ue(e),e.followHead)w(e),b(e);V(e),e.fire("resize"),e.previousContainerWidth=m(e),e.topReseter&&e.topReseter()}function se(e,t,n,i){if(e)e.style.top=n+"px",e.style.left=i+"px",e.style.position=t}function le(e){if(e.followHead&&!e.topReseter){var t=l(e),n=o(e,"top-placeholder"),i=document.createElement("div");i.id=n,i.style.width="100%",i.style.display="none",Pe.insertBefore(i,e.main),i=null,e.topReseter=function(){if(e.followHead){var i=Pe.page.getScrollTop(),r=Pe.ie&&Pe.ie<7?"absolute":"fixed",a=e.main.offsetHeight,o="absolute"==r,s=Pe.g(n),l=e.followDoms;if(e.noFollowHeadCache){var u=t.style.position;if("fixed"!==u&&"absolute"!==u)x(e)}if(i>e.followTop&&(o||i-e.followTop<a)){var d=Pe.page.getScrollLeft(),c=e.followHeightArr,f=c.length;V(e);var h=o?e.left:e.left-d;if(s.style.height=c[f-1]+t.offsetHeight+"px",s.style.display="",Pe.ie&&Pe.ie<8)t.style.zIndex=e.zIndex+1;if(o){for(var p=0,m=l.length;m>p;p++)se(l[p],r,c[p]+i,h);se(t,r,c[f-1]+i,h)}else{for(var p=0,m=l.length;m>p;p++)se(l[p],r,c[p],h);se(t,r,c[f-1],h)}}else{s.style.height=0,s.style.display="none",r="";for(var p=0,m=l.length;m>p;p++)se(l[p],r,0,0);se(t,r,0,0),t.style.zIndex=""}}},Ie.addDOMEvent(e,window,"scroll",e.topReseter)}}function ue(e){var t=e.colsWidth,n=e.foot,i=e.id,a=n instanceof Array&&n.length,o=u(e).getElementsByTagName("td"),s=o.length,l=e.rowWidthOffset;if(a)for(var d=0,c=0;a>c;c++){for(var f=n[c],h=t[d],p=f.colspan||1,m=1;p>m;m++)h+=t[d+m];d+=p;var g=Pe.g(P(e,c));h=Math.max(h+l,0),g.style.width=h+"px",g.style.display=h?"":"none"}if(a=t.length,!e.noHead)for(var c=0;a>c;c++){var h=Math.max(t[c]+l,0),g=Pe.g(S(e,c));g.style.width=h+"px",g.style.display=h?"":"none"}for(var m=0,c=0;s>c;c++){var g=o[c];if(r(g,"control-table")==i){var h=Math.max(t[m%a]+l,0);g.style.width=h+"px",g.style.display=h?"":"none",m++}}}function de(e){return{width:30,stable:!0,select:!0,title:function(t,n){var i={id:o(e,"select-all"),className:s(e,"select-all"),disabled:e.disabled?'disabled="disabled"':"",index:n};return Pe.format(We,i)},content:function(t,n){var i={id:o(e,"multi-select")+n,className:s(e,"multi-select"),disabled:e.disabled?'disabled="disabled"':"",index:n,checked:p(e,n)?'checked="checked"':""};return Pe.format(Fe,i)}}}function ce(e){return{width:30,stable:!0,title:"&nbsp;",select:!0,content:function(t,n){var i=o(e,"single-select"),r={id:i+n,name:i,className:s(e,"single-select"),index:n,disabled:e.disabled?'disabled="disabled"':"",checked:p(e,n)?'checked="checked"':""};return Pe.format($e,r)}}}function fe(e,t){var n=r(e,"index");he(this,n),pe(this)}function he(e,n,i){var a="row-selected";if(n>=0){var s=Pe.g(o(e,"multi-select")+n);if(s){t(i)&&(s.checked=i);var l=c(e,n);if(s.checked)Ie.addPartClasses(e,a,l);else Ie.removePartClasses(e,a,l)}}else if(t(i))for(var u=ge(e,"checkbox"),d=0,f=u.length;f>d;d++){var s=u[d];s.checked=i;var h=r(s,"index"),l=c(e,h);if(i)Ie.addPartClasses(e,a,l);else Ie.removePartClasses(e,a,l)}}function pe(e){for(var t=f(e),n=ge(e,"checkbox"),i=!0,a=[],s=o(e,"multi-select"),l=0,u=n.length;u>l;l++){var d=n[l];if(d.id.indexOf(s)>=0){var c=r(d,"index");if(!d.checked)i=!1;else a.push(c)}}h(e,a),e.fire("select",{selectedIndex:a}),t.checked=i}function me(e){ve(this,f(this).checked)}function ge(e,t){for(var n=u(e).getElementsByTagName("input"),i=[],r=0,a=n.length;a>r;r++){var o=n[r],s=o.id;if(o.getAttribute("type")==t&&s)i.push(o)}return i}function ve(e,t){he(e,-1,t),pe(e)}function ye(e,t){_e(this,r(e,"index"))}function _e(e,n,i){var r=e.selectedIndex,a=Pe.g(o(e,"single-select")+n);if(a){if(t(i)&&(a.checked=i),e.fire("select",{selectedIndex:n}),r&&r.length)Ie.removePartClasses(e,"row-selected",c(e,r[0]));h(e,[n]),Ie.addPartClasses(e,"row-selected",c(e,n))}}function be(e){e.main.style.zIndex=e.zIndex||""}function we(e){for(var t=ge(e,"multi"==e.select?"checkbox":"radio"),n=t.length-1;n>=0;n--)if(e.disabled)t[n].setAttribute("disabled","disabled");else t[n].removeAttribute("disabled");if("multi"==e.select){var i=f(e);if(i)if(e.disabled)i.setAttribute("disabled","disabled");else i.removeAttribute("disabled")}if(e.children&&e.children.length)for(var r=e.children,n=r.length-1;n>=0;n--)r[n].setDisabled(e.disabled)}function xe(e){var t=" "+e+" ";return function(e){var n=" "+e.className+" ";return n.replace(Be," ").indexOf(t)>=0}}function Me(e,t){var n=null;if(t)n="function"==typeof t?t:xe(t);return{handler:e,matchFn:n}}function Le(e,t,n){var i=t.id,r=e.handlers[i];if(!r)r=e.handlers[i]={};if(n)if(r=e.handlers[n],!r)r=e.handlers[n]=[];return r}function Te(e,t,n,i){var r=Le(e,t,n),a=[];if(!r.length)ke(e,t,n);for(var o=0,s=i.length;s>o;o++){var l=i[o],u=Me(l.handler,l.matchFn);r.push(u),a.push(u)}return a}function Ce(e,t,n,i){for(var r=Le(e,t,n),a=0,o=i.length;o>a;a++)for(var s=i[a],l=0,u=r.length;u>l;l++)if(r[l]==s)r.splice(l,1),l--;if(!r.length)Ye(e,t,n)}function De(e,t,n){return function(i){for(var i=i||window.event,r=i.target;r;){if(1===r.nodeType)for(var a=t.length-1;a>=0;a--){var o=t[a];if(!o.matchFn||o.matchFn(r))o.handler.call(n,r,i)}if(r==e)break;r=r.parentNode}}}function ke(e,t,n){var i=Le(e,t,n);Ie.addDOMEvent(e,t,n,De(t,i,e))}function Ye(e,t,n){Ie.removeDOMEvent(e,t,n)}function Se(e){var t=Ie.getPartClasses,n=t(e,"row")[0],i=t(e,"hcell")[0],r=t(e,"select-all")[0],a=t(e,"multi-select")[0],o=t(e,"single-select")[0];Te(e,e.main,"mouseover",[{handler:ne,matchFn:n},{handler:E,matchFn:i}]),Te(e,e.main,"mouseout",[{handler:ie,matchFn:n},{handler:N,matchFn:i}]),Te(e,e.main,"click",[{handler:re,matchFn:n},{handler:O,matchFn:i},{handler:me,matchFn:r},{handler:fe,matchFn:a},{handler:ye,matchFn:o}])}var Pe=require("esui/lib"),Ee=require("underscore"),Ie=require("esui/controlHelper"),Ne=require("esui/Control");e.defaultProperties={noDataHtml:"没有数据",noFollowHeadCache:!1,followHead:!1,sortable:!1,encode:!1,columnResizable:!1,rowWidthOffset:-1,select:"",selectMode:"box",subrowMutex:1,subEntryOpenTip:"点击展开",subEntryCloseTip:"点击收起",subEntryWidth:18,breakLine:!1,hasTip:!1,hasSubrow:!1,tipWidth:18,sortWidth:9,fontSize:13,colPadding:8,zIndex:0};var je='<table cellpadding="0" cellspacing="0" width="${width}" data-control-table="${controlTableId}">',Oe='<div class="${className}"></div>',Ae='<div id="${id}" class="${className}" data-ui="type:Tip;id:${id};content:${content}"></div>',He='<div class="${className}">${html}</div>',Re='<div id="${id}" class="${className}" data-index="${index}" ${attr}>',Ve='<span id="${colTextId}">${content}</span>',We='<input type="checkbox" id="${id}" class="${className}" data-index="${index}" ${disabled}/>',Fe='<input type="checkbox" id="${id}" class="${className}" data-index="${index}" ${disabled} ${checked} />',$e='<input type="radio" id="${id}" name="${name}" class="${className}" data-index="${index}" ${disabled} ${checked} />',Be=/[\t\r\n]/g;return e.prototype={type:"Table",initOptions:function(t){var n={};Ee.extend(n,e.defaultProperties,t),this.setProperties(n)},previousContainerWidth:null,initStructure:function(){var e=this.fields.length,t=0,n=0;for(t=0;e>t;t++){if("number"!=typeof this.fields[t].width||isNaN(this.fields[t].width))this.fields[t].width=100;n+=this.fields[t].width}if(this.realWidth=n,this.realWidth)this.main.style.width=this.realWidth+"px";be(this),K(this),ae(this),Se(this)},repaint:function(t,n){Ne.prototype.repaint.apply(this,arguments);var i=this,r=e.defaultProperties,a={};if(!t){for(var o in r)if(r.hasOwnProperty(o))a[o]=!0}else for(var s=0;s<t.length;s++){var l=t[s];a[l.name]=!0}var u=!1,d=!1,c=!1;if(a.fields||a.select||a.selectMode||a.sortable)g(i),u=!0;if(u||a.breakLine||a.colPadding||a.fontSize)M(i),L(i),d=!0;if(u||d||a.noHead||a.order||a.orderBy||a.selectedIndex)D(i);if(a.followHead||a.noFollowHeadCache)v(i),le(i);if(u||d||a.encode||a.noDataHtml||a.datasource||a.selectedIndex)U(i),c=!0;if(c||a.bodyMaxHeight)G(i);if(u||d||a.foot)T(i);if(i.extraRepaint=Ie.createRepaint([{name:"disabled",paint:we},{name:"width",paint:oe},{name:"zIndex",paint:be}]),i.extraRepaint(t,n),c&&Ie.isInStage(i,"RENDERED"))switch(i.select){case"multi":h(i,[]),i.fire("select",{selectedIndex:i.selectedIndex})}if(i.realWidth!=m(i))oe(i,!0);var f=this.colsWidth.length,s=0,p=0;for(s=0;f>s;s++){if("number"!=typeof this.colsWidth[s]||isNaN(this.colsWidth[s]))console.log("宽度错误:"+this.colsWidth[s]),this.colsWidth[s]=100;p+=this.colsWidth[s]}if(this.realWidth=p,this.realWidth)this.main.style.width=this.realWidth+"px"},getId:function(e){return o(this,e)},getBodyCellId:function(e,t){return J(this,e,t)},setCellText:function(e,t,i,r){if(r)e=Pe.encodeHTML(e);e=n(e)?"&nbsp":e,Pe.g(o(this,"cell-textfield-"+t+"-"+i)).innerHTML=e},getClass:function(e){return s(this,e)},getRow:function(e){return c(this,e)},addRowBuilders:function(e){Z(this,e)},addHandlers:function(e,t){if(!t.length)t=[t];return Te(this,this.main,e,t)},removeHandlers:function(e,t){if(!t.length)t=[t];Ce(this,this.main,e,t)},adjustWidth:function(){oe(this)},setDatasource:function(e){this.datasource=e,h(this,[]);var t={name:"datasource"},n={name:"selectedIndex"};this.repaint([t,n],{datasource:t,selectedIndex:n})},updateRowAt:function(e,t){t&&(this.datasource[e]=t);var n=this.datasource[e],i=c(this,e);if(n&&i){this.fire("beforerowupdate",{index:e,data:n});var r=document.createElement("div");r.innerHTML=Q(this,t,e,this.rowBuilderList);var a=r.children[0];i.parentNode.replaceChild(a,i),this.fire("afterrowupdate",{index:e,data:n})}},getSelectedItems:function(){var e=this.selectedIndex,t=[];if(e){var n=this.datasource;if(n)for(var i=0;i<e.length;i++)t.push(n[e[i]])}return t},setRowSelected:function(e,t){var n=this,i="multi"===n.select,r=i?he:_e;if(Ee.isArray(e))if(i)Ee.each(e,function(e){r(n,e,t)});else r(n,e[0],t);else r(n,e,t);if(i)pe(n)},setAllRowSelected:function(e){this.setRowSelected(-1,e)},resetFollowHead:function(){y(this)},dispose:function(){if(!Ie.isInStage(this,"DISPOSED")){Ie.beforeDispose(this);var e=this.main;if(e){this.followDoms=null;var t=Pe.g(o(this,"drag-mark"));if(t)document.body.removeChild(t)}this.rowBuilderList=null,this.headPanel.disposeChildren(),this.bodyPanel.disposeChildren(),this.headPanel=null,this.bodyPanel=null,Ie.dispose(this),Ie.afterDispose(this)}}},Pe.inherits(e,Ne),require("esui/main").register(e),e});