define(function(require){function e(){a.apply(this,arguments)}function t(e){for(var t=i.event.getTarget(e),n=this.layer.getElement();t&&t!==n&&!i.hasAttribute(t,"data-index");)t=t.parentNode;if(t&&!this.helper.isPart(t,"item-disabled")){var r=t.getAttribute("data-index"),a=this.getChild("input"),o=this.datasource[+r].text;a.setValue(o),this.rawValue=o,this.fire("select",o),this.fire("match",o),this.layer.hide()}}function n(){r.apply(this,arguments),this.layer=new e(this)}var i=require("esui/lib"),r=require("esui/InputControl"),a=(require("esui/TextBox"),require("esui/Layer")),o=require("underscore"),s="drop-btn";i.inherits(e,a),e.prototype.nodeName="div",e.prototype.render=function(e){for(var t='<div class="match-input-layer-content"><ol>',n=this.control.datasource||[],i=0;i<n.length;i++){var r=n[i],a=this.control.helper.getPartClasses("item");if(r.disabled)a.push.apply(a,this.control.helper.getPartClasses("item-disabled"));t+='<li data-index="'+i+'" class="'+a.join(" ")+'">',t+=r.text,t+="</li>"}t+="</ol></div>",e.innerHTML=t},e.prototype.initBehavior=function(e){this.control.helper.addDOMEvent(e,"click",t)},e.prototype.dock={strictWidth:!0},n.prototype.type="MatchInput",n.prototype.initOptions=function(e){var t={width:200};o.extend(t,e),this.setProperties(t)},n.prototype.initStructure=function(){var e=this.helper.getId(s),t=this.helper.getPartClassName(s),n='<div data-ui="type:TextBox;childName:input;"></div><div id="'+e+'" class="'+t+'"></div>';this.main.innerHTML=n,this.helper.initChildren()},n.prototype.delegateEvent=function(e){var t=require("mini-event").fromEvent(e,{preserveData:!0,syncState:!0});if(t.type)this.fire(t)},n.prototype.initEvents=function(){var e=this,t=this.helper.getPart(s),n=this.getChild("input");e.helper.addDOMEvent(t,"click",function(){e.layer.toggle()}),n.on("input",function(t){e.layer.hide();var i=n.getValue();e.rawValue=i;var r=o.find(e.datasource,function(e){return e.text===i});if(r)e.fire("match",i);else e.fire("unmatch",i);e.fire("change",t)}),n.on("focus",function(){e.layer.hide()}),n.on("*",e.delegateEvent,e)};var l=require("esui/painters");return n.prototype.repaint=l.createRepaint(r.prototype.repaint,{name:"width",paint:function(e,t){var n=e.getChild("input"),i=e.helper.getPart(s);n.set("width",t-i.offsetWidth)}},{name:"datasource",paint:function(e){e.layer.repaint()}},{name:"rawValue",paint:function(e,t){var n=e.getChild("input");n.setRawValue(t);var i=o.find(e.datasource,function(e){return e.text===t});if(i)e.fire("match",t);else e.fire("unmatch",t)}},{name:"placeholder",paint:function(e,t){var n=e.getChild("input");n.set("placeholder",t)}},{name:"disabled",paint:function(e,t){var n=e.getChild("input");n.setDisabled(t)}},{name:["disabled","hidden","readOnly"],paint:function(e,t,n,i){if(t||n||i)e.layer.hide()}}),n.prototype.dispose=function(){if(!this.helper.isInStage("DISPOSED")){if(this.layer)this.layer.dispose(),this.layer=null;r.prototype.dispose.apply(this,arguments)}},i.inherits(n,r),require("esui/main").register(n),n});