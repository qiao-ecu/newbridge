define(function(require){function e(e,t){this.modelType=e,this.viewType=t,this.on("beforemodelload",function(){var e=this;i.on("data",function(t){var n=e.view;if(n){var i=n.get("visitor"),s=t.name+","+t.subViewName+","+t.dynamicViewName,u=o[s];if(u){var d=l[t.type],c=i.get("selectVisitor");r.map(t.value,function(e){if(c===e.bid)if(e.block)a.disable("blockIcon",!1);else a.disable("blockIcon",!0);e.type=u,i[d](e)}),e.view.changeIconStatus()}}})}),n.apply(this,arguments)}var t=require("er/util"),n=require("er/Action"),i=requireNode("client-vm")(),r=require("underscore"),a=require("./main");e.prototype.startConversation=function(e){};var o={"vm:visitor,onsite,chatting":"talking","vm:visitor,onsite,queueing":"waiting","vm:visitor,onsite,inviting":"inviting","vm:visitor,onsite,visiting":"visiting","vm:visitor,onsite,roboting":"robot","vm:visitor,recent,recent":"recent","vm:visitor,left,left":"leave"},s={talking:["vm:visitor","onsite","chatting"],waiting:["vm:visitor","onsite","queueing"],inviting:["vm:visitor","onsite","inviting"],visiting:["vm:visitor","onsite","visiting"],robot:["vm:visitor","onsite","roboting"],recent:["vm:visitor","recent","recent"],leave:["vm:visitor","left","left"]},l={insert:"add",update:"edit","delete":"remove"};return e.prototype.forceChat=function(){var e=this.view.get("visitor"),t=e.get("selectVisitor"),n=e.get("selectedType"),r=s[n].concat();r.push("forcechat"),r.push(t),i.action.apply(i,r)},e.prototype.block=function(){var e=this.view.get("visitor"),t=e.get("selectVisitor"),n=e.get("selectedType"),r=s[n].concat();r.push("block"),r.push(t),i.action.apply(i,r)},e.prototype.select=function(){var e=this.view.get("visitor"),t=e.get("selectVisitor"),n=e.get("selectedType"),r=s[n].concat();r.push("select"),r.push(t),i.action.apply(i,r),this.startConversation(t)},e.prototype.dblclick=function(e){var t,n;if(e)t=e.id,n=e.visitorType;else{var r=this.view.get("visitor");t=r.get("selectVisitor"),n=r.get("selectedType")}var a=s[n].concat();a.push("dblclick"),a.push(t),i.action.apply(i,a)},e.prototype.kill=function(){var e=this.view.get("visitor"),t=e.get("selectVisitor"),n=e.get("selectedType"),r=s[n].concat();r.push("close"),r.push(t),i.action.apply(i,r)},e.prototype.initBehavior=function(){var e=this,t=e.view,n=(e.model,t.get("visitor"));n.on("select",function(){e.select()}),n.on("dblclick",function(t){e.dblclick(t)})},t.inherits(e,n),e});