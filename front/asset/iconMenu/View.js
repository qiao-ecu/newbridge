define(function(require,exports,module){function e(){t.apply(this,arguments),this.icons=[]}var t=require("ef/UIView"),n=require("er/util"),i=require("underscore"),r=require("esui"),a=require("common/util/globalData");return require("tpl!./main.tpl"),require("common/esuix/Icon"),require("common/esuix/VerticalTipLayer"),e.prototype.template="iconMenu",e.prototype.uiProperties={icon:{max:10}},e.prototype.uiEvents={"icon:click":function(){var e=this.get("icon");setInterval(function(){e.updateNotify(e.notification-0+1)},1e3)}},e.prototype.addIcons=function(e){this.icons=this.icons.concat(e),this.icons.sort(function(e,t){return e.priority-t.priority}),this.renderIcons(this.icons)},e.prototype.renderIcons=function(e){var t=this.getContainerElement(),n=t.getElementsByClassName("icon-menu")[0];i.map(e,function(e){e.appendTo(n)})},e.prototype.initQrCode=function(){var e=r.create("VerticalTipLayer",{width:420,height:350,title:"欢迎使用移动商桥",content:'<div data-ui="type:DualCachedPanel;id:tip;url:/mobileQrcode"></div>'});e.appendTo(document.body),e.render(),e.attachTo({targetControl:"mobileIcon",showMode:"click",positionOpt:{top:"bottom",right:"right"}})},e.prototype.enterDocument=function(){var e=this;t.prototype.enterDocument.call(this,arguments);var n=a.get("domain"),i=a.get("token"),o=r.create("Icon",{className:"icon-menu-settings-icon",disabled:!0,content:"系统设置"}),s=r.create("Icon",{id:"mobileIcon",className:"icon-menu-mobile-icon",disabled:!1,content:"移动商桥"}),l=r.create("Icon",{id:"account",className:"icon-menu-account-icon",disabled:!1,content:"账号管理",toolbar:!1,windowWidth:980,windowHeight:600,priority:10,url:"http://"+n+"/user/initList.action?token="+i}),u=r.create("Icon",{id:"role",className:"icon-menu-role-icon",disabled:!1,content:"角色管理",toolbar:!1,windowWidth:980,windowHeight:600,priority:11,url:"http://"+n+"/authority/roleList.action?token="+i}),d=r.create("Icon",{id:"site",className:"icon-menu-site-icon",disabled:!1,content:"站点管理",toolbar:!1,windowWidth:980,windowHeight:600,priority:11,url:"http://"+n+"/siteManage/siteIndex.action?token="+i}),c=r.create("Icon",{id:"leaveMessage",className:"icon-menu-leave-message-icon",disabled:!1,windowWidth:980,windowHeight:600,content:"留言管理",toolbar:!1,priority:12,url:"http://"+n+"/bookmanage/initBook.action?token="+i}),f=r.create("Icon",{id:"report",className:"icon-menu-report-icon",disabled:!1,content:"数据统计",toolbar:!1,windowWidth:980,windowHeight:600,priority:13,url:"http://"+n+"/report/reportIndex.action?token="+i});this.leaveMessageIcon=c;var h=e.model.get("leaveMessage"),p=h[0]||0;c.set("notification",p),this.addIcons([o,s,u,d,l,c,f]),this.initQrCode()},n.inherits(e,t),e});