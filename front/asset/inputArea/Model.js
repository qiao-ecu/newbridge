define(function(require,exports,module){function e(){n.apply(this,arguments);var e=this.get("visitorId");if(e)this.datasource={chatList:a(i.data("vm:visitor","onsite","chatting")),content:a(i.data("vm:chatroom","typing","typing",{bid:e}))};if(this.db=new s("newbridge",localStorage),!this.db.tableExists("inputArea"))this.db.createTable("inputArea",["serviceId","fontFamily","fontSize","fontWeight","fontStyle","textDecoration","sendMode"]),this.db.commit()}var t=require("er/util"),n=require("ef/UIModel"),i=requireNode("client-vm")(),r=require("er/datasource"),a=r.constant,o=require("underscore"),s=require("common/util/localStorageDB");return e.prototype.prepare=function(){n.prototype.prepare.apply(this,arguments);var e=this.get("visitorId"),t=o.some(this.get("chatList"),function(t){return t.bid===e});this.set("isChatting",t);var i=!t&&e;this.set("displayNotChattingWarning",i)},t.inherits(e,n),e});