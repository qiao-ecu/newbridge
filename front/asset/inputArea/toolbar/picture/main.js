define(function(){var e,t,n,exports={};return exports.bindEvent=function(e,n){t=e.g("nbwlPicInput"),n.domOn(t,"change",function(e){exports.fileSelected(t)})},exports.checkExt=function(e,t){var n=e.picExt,i=t.value,r=i.substring(i.lastIndexOf(".")).toLowerCase();if(-1===n.indexOf(r))return!1;else return!0},exports.checkSize=function(e,t){var n=e.sizeLimit,i=0;if(!n)return!0;try{if("files"in t)i=t.files[0].size;else{var r=new ActiveXObject("Scripting.FileSystemObject"),a=t.value,o=r.getFile(a);i=o.size}}catch(s){}if(i>n)return!1;else return!0},exports.send=function(e){},exports.resetInput=function(){n.innerHTML=n.innerHTML,exports.bindEvent()},exports.message=function(e){},exports.fileSelected=function(e,i,r,a,o,s){if(s.value)if(exports.checkExt(s))if(exports.checkSize(s))if(i.isConnected()){var l=r.uuid(),u="msg"+ +new Date,d=a.format(o.get("imgMessage"),{bcsname:l});exports.send({type:"img",id:u,bcsName:l,form:n,text:d,role:0,path:t.value})}},exports.render=function(i,r,a){a.appendHTML(r.format(i.get("picture")),e),t=a.g("nbwlPicInput"),n=a.g("nbwlPicForm")},exports.init=function(t,n,i){e=t.g("nbwlToolBar"),n.parse(i),exports.render(),exports.bindEvent()},exports});