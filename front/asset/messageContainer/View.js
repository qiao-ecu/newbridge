define(function(require,exports,module){function e(){t.apply(this,arguments)}var t=require("ef/UIView"),n=require("er/util"),i=(require("er/URL"),require("underscore")),r=require("jquery"),a=require("common/message/messageFactory");require("tpl!./main.tpl");var o=require("eff"),s=(o.Either.Left,o.Either.Right);o.Monad.mApply,o.Monad.flow;return e.prototype.template="messageContainer",e.prototype.uiProperties={},e.prototype.uiEvents={},e.prototype.addMessage=function(e){var t=this,n=this.model.get("visitorId");if(e.bid===n){var i=this.messageContainer;a.get(e,"messagecontainer").mApply(function(e){var n=e.render();return t.scrollToBottom(),s(i.appendChild(n))})}},e.prototype.updateMessage=function(e){var t=this.model.get("visitorId");i.map(e,function(e){if(e.bid===t)a.update(e)},this)},e.prototype.addMessages=function(e){i.map(e,function(e){this.addMessage(e)},this)},e.prototype.scrollToBottom=function(e){var t=e,n=this,i=this.messageContainer;if(!t)t=this.isBottom();if(t)setTimeout(function(){i.scrollTop=1/0},0),n.hideUnread();else n.showUnread()},e.prototype.isBottom=function(){var e=!1,t=this.messageContainer,n=t.parentNode.offsetHeight,i=t.scrollHeight;if(i-t.scrollTop<=n)e=!0;return e},e.prototype.showUnread=function(){var e=this.getContainerElement();r(".chat-area-unread",e).show()},e.prototype.hideUnread=function(){var e=this.getContainerElement();r(".chat-area-unread",e).hide()},e.prototype.preview=function(e){},e.prototype.enterDocument=function(){var e=this;t.prototype.enterDocument.call(this,arguments);var n=this.getContainerElement();this.messageContainer=n.getElementsByClassName("chat-area-message-container")[0],r(".chat-area-message-container").on("click","img[data-bcsname]",function(){var t=r(this).attr("data-bcsname");console.log("您点击了图片:"+t),e.preview(t)}),r(".chat-area-message-container").on("scroll",function(){if(e.isBottom())e.hideUnread()}),r(".chat-area-unread").on("click",function(){e.scrollToBottom(!0)});var i=this.model.get("messages");this.addMessages(i)},n.inherits(e,t),e});