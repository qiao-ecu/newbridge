define(function(require,exports,module){function e(){t.apply(this,arguments)}var t=require("ef/UIView"),n=require("er/util"),i=(require("er/URL"),require("underscore")),r=require("jquery"),a=require("common/message/messageFactory");require("tpl!./main.tpl");var o=require("eff"),s=(o.Either.Left,o.Either.Right);o.Monad.mApply,o.Monad.flow;return e.prototype.template="messageContainer",e.prototype.uiProperties={},e.prototype.uiEvents={},e.prototype.addMessage=function(e){var t=this,n=this.model.get("visitorId");if(e.bid===n){var i=this.messageContainer;a.get(e,"messagecontainer").mApply(function(e){var n=e.render();return t.scrollToBottom(),s(i.appendChild(n))})}},e.prototype.updateMessage=function(e){var t=this.model.get("visitorId");i.map(e,function(e){if(e.bid===t)a.update(e)},this)},e.prototype.addMessages=function(e){i.map(e,function(e){this.addMessage(e)},this)},e.prototype.scrollToBottom=function(e){var t=e,n=this.messageContainer;if(!t){var i=n.parentNode.offsetHeight,r=n.scrollHeight;if(r-n.scrollTop<=i)t=!0}if(t)setTimeout(function(){n.scrollTop=1/0},0)},e.prototype.preview=function(e){},e.prototype.enterDocument=function(){var e=this;t.prototype.enterDocument.call(this,arguments);var n=this.getContainerElement();this.messageContainer=n.getElementsByClassName("chat-area-message-container")[0],r(".chat-area-message-container").on("click","img[data-bcsname]",function(){var t=r(this).attr("data-bcsname");console.log("您点击了图片:"+t),e.preview(t)});var i=this.model.get("messages");this.addMessages(i)},n.inherits(e,t),e});