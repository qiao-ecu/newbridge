define(function(require){function e(){t.apply(this,arguments)}var t=require("ef/UIView"),n=require("er/util"),i=require("jquery"),r=require("common/esuix/Dialog"),a=require("esui/validator/Validity");return require("common/esuix/MatchInput"),require("common/esuix/SelectList"),require("esui/validator/RequiredRule"),require("esui/CheckBox"),e.prototype.template="login",e.prototype.uiProperties={username:{datasource:"@usernames",width:224,placeholder:"用户名",validityLabel:"usernameerr",title:"用户名",required:!0},password:{validityLabel:"passworderr",placeholder:"密码",title:"密码",required:!0,width:224},captcha:{width:132,placeholder:"验证码",validityLabel:"captchaerr",title:"验证码"},status:{itemTemplate:'<div class="login-${classPart}"></div><span class="login-status-text">${name}</span>',displayTemplate:'<div class="login-${classPart}"></div><span class="login-status-text">${name}</span>',datasource:[{name:"空闲",classPart:"free",selectedIndex:0},{name:"忙碌",classPart:"busy",selectedIndex:1},{name:"离开",classPart:"afk",selectedIndex:2}]},remenber:{checked:!0},autologin:{checked:!0},loginbtn:{width:204}},e.prototype.uiEvents={"username:match":function(e){this.fire("match",e.data),this.hideLoginValidity(),i(".login .login-delete").show()},"username:unmatch":function(e){this.fire("unmatch",e.data),this.hideLoginValidity(),i(".login .login-delete").hide()},"username:change":function(e){this.hideCaptcha()},"remenber:change":function(){if(!this.get("remenber").isChecked())this.get("autologin").setChecked(!1)},"autologin:change":function(){if(this.get("autologin").isChecked())this.get("remenber").setChecked(!0)},"username:focus":function(e){this.hideLoginValidity()},"password:focus":function(e){this.hideLoginValidity()},"password:keypress":function(e){if(13===e.keyCode)this.fire("login")},"loginbtn:click":function(e){this.hideLoginValidity();var t=this.get("loginbtn");if(!t.hasState("logining"))if(t.hasState("cancelable"))this.fire("cancellogin");else{var n=this.get("username").validate(),i=this.get("password").validate();if(n&&i)this.fire("login")}}},e.prototype.showLoginValidity=function(e){var t=new a;t.setCustomValidState("invalid"),t.setCustomMessage(e),this.get("password").showValidity(t)},e.prototype.hideLoginValidity=function(){var e=new a;e.setCustomValidState("valid"),e.setCustomMessage(""),this.get("password").showValidity(e)},e.prototype.resetUserInfo=function(){this.get("username").setValue(""),this.get("password").setValue(""),this.get("password").setDisabled(!1),this.get("captcha").setValue(""),this.get("status").set("selectedIndex",0),this.get("remenber").setChecked(!0),this.get("autologin").setChecked(!0)},e.prototype.showCaptcha=function(e){i(".login-captcha-image").attr("src",e),i(".login-captcha-container").show(),this.get("captcha").setValue("")},e.prototype.hideCaptcha=function(){i(".login-captcha-container").hide(),this.get("captcha").setValue("")},e.prototype.show=function(){},e.prototype.enterDocument=function(){document.title="百度商桥",t.prototype.enterDocument.call(this,arguments);var e=this.getContainerElement(),n=this;i(".login .login-delete",e).on("click",function(){var e=n.get("username").getValue(),t=r.confirm({top:75,title:"确认删除？",skin:"warn",content:"您确定要删除账号在本机的登陆列表信息和与顾问的沟通记录？",width:400});t.on("ok",function(){n.resetUserInfo(),n.hideCaptcha(),n.fire("delete",e)})}),i("a",e).on("click",function(e){var t=window.require,n=i(this).attr("data-href"),r=t("nw.gui");r.Shell.openExternal(n),e.stopPropagation()}),i(".login-captcha-image",e).on("click",function(){var t=i(".login-captcha-image",e).attr("src");t=t.replace(/\&v\=\d+/g,""),i(".login-captcha-image",e).attr("src",t+"&v="+(new Date-0))}),this.show()},n.inherits(e,t),e});