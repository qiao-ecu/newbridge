function pad(e){return(e>=10?"":"0")+e}function timeFormat(e){return e.getFullYear()+"-"+pad(e.getMonth()+1)+"-"+pad(e.getDate())+" "+pad(e.getHours())+":"+pad(e.getMinutes())+":"+pad(e.getSeconds())+":"+pad(e.getMilliseconds())}var path=require("path"),fs=require("fs"),mkdirp=require("mkdirp"),winston=require("winston"),moment=require("moment"),Logger=winston.Logger,DailyRotateFile=winston.transports.DailyRotateFile,consts=require("./const"),singtonLog;module.exports=function(){if(singtonLog)return singtonLog;var e=path.resolve(process.cwd(),"log");if(!fs.existsSync(e))mkdirp.sync(e);var t=new DailyRotateFile({name:"info-log",level:"info",filename:path.resolve(e,"client-vm.log"),datePattern:".yyyy-MM-dd",maxFiles:5,stringify:function(e){var t={level:e.level,time:timeFormat(new Date(e.timestamp)),message:e.message};return t.time+" ["+t.level+"] "+t.message}}),n=new DailyRotateFile({name:"warn-log",level:"warn",filename:path.resolve(e,"client-vm-warn.log"),datePattern:".yyyy-MM-dd",maxFiles:5,stringify:function(e){var t={level:e.level,time:timeFormat(new Date(e.timestamp)),message:e.message};return t.time+" ["+t.level.toUpperCase()+"] "+t.message}});return singtonLog=new Logger({transports:[t,n],prettyPrint:!0,colorize:!0}),singtonLog.on("logging",function(e,t,n,i){if("error"==t)singtonLog.emit(consts.EVENT_SYSTEM_ATTENTION,n,i)}),setInterval(function(){fs.readdir(e,function(e,t){if(e)singtonLog.error("Can not process maxFiles %s.",JSON.stringify(e));else{var n=moment().subtract(5,"days").format("YYYY-MM-DD");t.forEach(function(e){if(e.indexOf(n)>0)fs.unlink(e)})}})},36e5),singtonLog};