/**
 * @file 客户登出
 * @author cxl(chenxinle@baidu.com)
 */

var CONST = require('../const');
var curry = require('../util/curry');

/**
 * 登出响应处理
 * 暂时不关注是否发生错误
 * 直接退出
 *
 * @param {Function} resolve resolve
 */
function logoutHandler(resolve) {
    this._status = CONST.STATUS.OFFLINE;
    resolve();
}

/**
 * 客户登出
 *
 * @public
 * @param {Object} core 沟通内核
 * @return {Promise}
 */
module.exports = function (core) {
    var config = core._config;
    var data = {
        user: core._getUserInfo(),
        eid: config.eid,
        device: CONST.DEVICE.PC,
        role: config.role,
        token: config.token
    };

    var promise = new Promise(function (resolve) {
        core._send(CONST.MSG.REQUEST, CONST.CMD.AGT_LOGOUT, data);
        core._attachMsg(
            CONST.MSG.RESPONSE,
            CONST.CMD.AGT_LOGOUT,
            curry(logoutHandler, resolve),
            true
        );
    });

    return promise;
};
