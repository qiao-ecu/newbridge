import "cg_types.proto";
import "sess_body.proto";

package login_protocol;

//访客进入页面消息
message vst_pack {
    required cg.User user = 1;
    required cg.Visitor.Device device    = 2; //登录设备
    optional fixed32 ip                  = 3; //访客的ip
    required fixed32 siteid              = 4; //访客访问的siteid
    required fixed32 eid                 = 5; //访客访问的eid
    required string   url                 = 6; //访客访问的url

    optional vst_business_info businfo	 = 7; //业务相关信息
    optional terminal_info tinfo         = 8; //终端相关信息
    optional string reserved	             = 9; //json串，扩展之用
}

//访客消息统一回包
message vst_ack {
    required fixed32 eid    = 1; //访客访问的eid
    required fixed32 result = 2; //操作结果
    optional cg.User user = 3;
}

message vst_pack_login2rmg {
    required vst_pack req    = 1;
    required vst_ack ack     = 2;
    required fixed64 touuid = 3;
}

//通知访客状态变化
message notify_vst_stat {
    required cg.User user             = 1; //访客
    required fixed32 eid              = 2; //企业id
    required cg.Visitor.Device device = 3; //登录设备
    required fixed32 siteid           = 4; //站点id
    required cg.Visitor.Status status = 5; //访客状态
    optional string   sessionid        = 6; //sessionid
    optional string visitor_info       = 7; //json串, 由web生成，客户端解析
    optional fixed64 timestamp        = 8;
}

//百度云推送信息
message location {
    optional string bd_uid			= 1; //百度云推送用户id
    optional string bd_channel_id	= 2; //百度云推送通道id
    optional fixed32 device_type	= 3; //百度云推送设备类型
}

//访客业务信息
message vst_business_info {
    optional string bdclkid     = 1;     //百度clickid, 从访客请求的cookie中获取
    optional string word        = 2;     //检索词
    optional string wordid      = 3;     //检索词id
    optional string keyword     = 4;     //访客触发的客户购买的关键词id
    optional string fs          = 5;     //首次接待客服id
    optional fixed32 ftime     = 6;     //首次接待时间
    optional string ls          = 7;     //上次接待客服id
    optional fixed32 ltime     = 8;     //上次接待时间
    optional fixed32 time      = 9;     //访客本次访问的具体时间点
    optional fixed32 lv        = 10;    //历史访问次数
    optional fixed32 lvp       = 11;    //历史访问页面数
    optional fixed32 lc        = 12;    //历史沟通次数
    optional string referrer    = 13;    //来源，从访客请求的http头中获取
    optional string title       = 14;    //当前页面title
    optional string frequent    = 15;    //判断访客是否为熟客
    optional fixed32 calltime  = 16;    //访客本次使用网页回呼的具体时间点
    optional fixed32 fcalltime = 17;    //访客首次使用网页回呼的具体时间点
    optional fixed32 lcalltime = 18;    //访客上次使用网页回呼的具体时间点
    optional fixed32 lcallc    = 19;    //访客历史使用网页回呼次数的总和
    optional fixed32 fcalls    = 20;    //访客首次使用网页回呼接待的客服
    optional fixed32 lcalls    = 21;    //访客上次使用网页回呼接待的客服
    optional string baiduid     = 22;    //从访客请求的cookie中获取
    optional string hbdclckidsf = 23;    //从访客请求的cookie中获取
    optional string useragent   = 24;    //从访客请求的http头中获取
}

message terminal_info {
    optional location loc	 = 1;  //百度云推送信息
    optional fixed32 cbit	 = 2;  //颜色深度
    optional string fsl		 = 3;  //分辨率
    optional string coding	 = 4;  //编码
    optional string lang		 = 5;  //语言
    optional string tz		 = 6;  //时区
    optional fixed32 curtime = 7;  //终端当前时间戳，秒
    optional string os		 = 8;  //操作系统版本信息
}

//登录
message login {
    required cg.User user = 1;
    required fixed32 eid               	= 3;  //企业id
    required cg.Csr.Device device      	= 4;  //登录设备
    required sess.MsgBody.OprType role 	= 5;  //登录角色，0-客服，1-访客
    optional string username             = 6;  //用户名
    optional string passwd               = 7;  //密码
    optional string checkinfo            = 8;  //第三方验证所需字段

    optional fixed32 servicetype	    = 9;  //服务类型
    repeated string mac                  = 10; //登录mac地址列表
    repeated string ip                   = 11; //登录ip地址列表
    optional string vcode                = 12; //登录验证码
    optional cg.Csr.Status status       = 13; //客服登录初始状态设置
    optional string industry	            = 14; //行业信息
    optional fixed32 retry              = 15; //是否是重试
    optional string version              = 16; //客户端版本号
    optional vst_business_info businfo  = 17; //访客业务相关信息
    optional terminal_info terminfo     = 18; //终端信息
    optional string reserved             = 19; //json串，透传到web鉴权请求
    optional string publicip				= 20; //公网ip
}

message login_ack {
    required fixed32 result     = 1; //返回结果，非0表示失败
    required cg.User user = 2;
    required fixed32 eid        = 3; //企业id
    required string nickname     = 4; //昵称

    optional string token        = 5; //登录令牌
    optional string authfailinfo = 6; //json串，web鉴权请求失败结果
}

//登出
message logout {
    required cg.User user = 1;
    required fixed32 eid                = 2; //企业id
    required cg.Csr.Device device       = 3; //登录设备
    required sess.MsgBody.OprType role  = 4; //登录角色，0-客服，1-访客

    optional fixed32 servicetype        = 5; //服务类型, 0-贴心，1-度站，2-新商桥
    optional string token                = 6; //登录令牌
    repeated string mac                  = 7; //登录mac地址列表
    repeated string ip                   = 8; //登录ip地址列表
    optional string publicip				= 9; //公网ip
}

message logout_ack {
    required fixed32 result     = 1; //返回结果，非0表示失败
    required cg.User user = 2;
    required fixed32 eid        = 4; //企业id

    optional string webfailinfo	= 5; //json串，web登出结果
}

//添加好友
message agt_addfriend {
    required cg.User user = 1;
    required fixed32 eid      = 2; //企业id
    required cg.User friend = 3;
}

message agt_addfriend_ack {
    required fixed32 result   = 1; //返回结果
    required cg.User user = 2;
    required cg.User friend = 3;
}

//删除好友
message agt_delfriend {
    required cg.User user = 1;
    required fixed32 eid      = 2; //企业id
    required cg.User friend = 3;
}
message agt_delfriend_ack {
    required fixed32 result   = 1; //返回结果
    required cg.User user = 2;
    required cg.User friend = 3;
}

//获取好友
message agt_getfriend {
    required cg.User user = 1;
    required fixed32 eid    = 2; //企业id
}

message agt_getfriend_ack {
    message friend_node
    {
        required cg.User friend = 1;
        required string   nickname     = 2; //昵称
        required fixed32 eid          = 3; //企业id
        required string   groupid      = 4; //组id
        required cg.Csr.Status status = 5; //好友状态
    }
    required fixed32     result     = 1; //返回结果
    repeated friend_node friendlist = 2; //用户信息
}

//获取访客列表
message agt_getvst {
    required cg.User user = 1;
    required fixed32 eid = 2; //企业id
    optional string token = 3; //登录令牌
}

message agt_getvst_ack {
    message vst_node {
        required cg.User user = 1; //访客
        required fixed32  siteid          = 2; //访问站点id
        required cg.Visitor.Device device = 3; //访客登录设备
        required cg.Visitor.Status status = 4; //访客状态
        required sfixed32 reason          = 5; //状态原因码
        required fixed64  entertime       = 6; //进站时间
        required fixed32  enterip         = 7; //进站IP
    }

    required fixed32  result  = 1; //返回结果
    repeated vst_node vstlist = 2; //用户信息
}

//坐席变更状态
message agt_changestat {
    required cg.User user = 1;
    required fixed32 eid          = 2; //企业id
    required cg.Csr.Device device = 3; //登录设备
    required cg.Csr.Status status = 4; //改变的状态
    optional string token = 5; //登录令牌
}

message agt_changestat_ack {
    required fixed32 result       = 1; //返回结果
    required cg.User user = 2;
    required cg.Csr.Status status = 3; //改变之前的状态
}

//访客变更状态
message vst_changestat {
    required cg.User user                = 1;
    required fixed32 eid                 = 2; //企业id
    required cg.Visitor.Device device    = 3; //登录设备
    required cg.Visitor.Status status    = 4; //改变后的状态
    optional cg.Visitor.Status lststatus = 5; //改变前的状态
    optional fixed32 siteid              = 6; //访客访问的siteid
	repeated cg.User toids               = 7; //默认通知列表
	optional string sessionid        = 8; //sessionid
	optional string info       = 9; //json串,其他需要通知的信息,客户端解析

}

//心跳
message agt_heartbeat {
    required cg.User user = 1;
    required fixed32 eid          = 2; //企业id
    required cg.Csr.Device device = 3; //登录设备

    optional string token        = 4; //登录令牌
}

message agt_heartbeat_ack {
    required fixed32 result = 1; //返回结果
    required cg.User user = 2;
}

//通知客服状态变化
message notify_agt_stat {
    required cg.User user = 1;
    required fixed32 eid          = 2; //企业id
    required string   nickname     = 3; //客服昵称
    required cg.Csr.Device device = 4; //登录设备
    required cg.Csr.Status status = 5; //客服动作
}

//踢下线
message notify_kickout {
    required cg.User user   = 1; //被踢的坐席
    required fixed32 reason = 2; //踢出原因
}

//获取沟通列表
message agt_getcomlist {
    required cg.User user  = 1; //客服
    required fixed32 eid   = 2; //企业id
    optional string   token = 3; //登录令牌
}

//获取沟通列表回复
message agt_getcomlist_ack {
    message vst_node {
        required cg.User user             = 1;
        required string   nickname         = 2;
        required fixed32 eid              = 3;
        required cg.Visitor.Device device = 4;
        optional string   info             = 5;
        optional fixed32 siteid           = 6;
    }

    message csr_node {
        required cg.User user         = 1;
        required string   nickname     = 2;
        required fixed32 eid          = 3;
        required cg.Csr.Device device = 4;
    }

    required fixed32  result    = 1; //返回结果
    optional string    reason    = 2; //出错信息
    required cg.User  user      = 3;
    required string    groupid   = 4; //所属组id
    required string    groupname = 5; //所属组名称
    repeated vst_node visitors  = 6; //访客列表
    repeated csr_node csrs      = 7; //同组好友
    optional string    token     = 8; //登录令牌
}

//获取状态接口
message agt_getcomstat {
    message vst_node {
        required cg.User user             = 1;
        required fixed32 eid              = 2;
        required cg.Visitor.Device device = 3;
        optional fixed32 siteid           = 4;
    }

    message csr_node {
        required cg.User user         = 1;
        required fixed32 eid          = 2;
        required cg.Csr.Device device = 3;
    }

    required cg.User  user     = 1;
    required fixed32  eid      = 2;
    repeated vst_node visitors = 3; //访客列表
    repeated csr_node csrs     = 4; //同组好友
    optional string    token    = 5; //登录令牌
}

//获取状态接口回复
message agt_getcomstat_ack {
    message vst_node {
        required cg.User user             = 1;
        required cg.Visitor.Device device = 2;
        required cg.Visitor.Status stat   = 3;
        optional fixed64 timestamp        = 4;
        optional string   sessionid        = 5;
        optional string   info             = 6;
        optional fixed32 siteid           = 7;
    }

    message csr_node {
        required cg.User user         = 1;
        required cg.Csr.Device device = 2;
        required cg.Csr.Status stat   = 3;
        repeated string   sessionid    = 4;
    }

    required fixed32  result   = 1;
    optional string    reason   = 2; //出错信息
    required cg.User  user     = 3;
    repeated vst_node visitors = 4; //访客列表
    repeated csr_node csrs     = 5; //同组好友
    optional string    token    = 6; //登录令牌
}
